import{a as _,G as A,V,ai as D,r as u,s as h,j as e,I as P,H as f,W as G}from"./index-Ba-_IHuQ.js";import{C as S,a as q,c as B,b as E,d as Y}from"./card-DocFJD5R.js";import{I}from"./input-BB7eCBwl.js";import{L as z}from"./label-3yzes-iA.js";import{L as H}from"./lock-DBiGO1t7.js";import{a as F,E as J}from"./eye-off-QLdkjG-i.js";const M=()=>{const{currentLanguage:r}=_(),{toast:a}=A(),n=V(),[p]=D(),[x,l]=u.useState(!1),[s,o]=u.useState(""),[t,d]=u.useState(""),[g,b]=u.useState(!1),[m,i]=u.useState(!1);return u.useEffect(()=>{(async()=>{var R,C;const v=new URLSearchParams(window.location.hash.substring(1)),w=p,y=v.get("access_token")||w.get("access_token"),c=v.get("refresh_token")||w.get("refresh_token"),N=v.get("type")||w.get("type"),O=w.get("lang");if(console.log("Reset Password - URL params:",{accessToken:!!y,refreshToken:!!c,type:N,langParam:O,fullUrl:window.location.href,hash:window.location.hash,search:window.location.search}),N==="recovery"&&y&&c)try{console.log("Setting session with tokens...");const{data:k,error:j}=await h.auth.setSession({access_token:y,refresh_token:c});if(j)console.error("Session error:",j),(R=j.message)!=null&&R.includes("expired")||(C=j.message)!=null&&C.includes("invalid")?a({title:r==="ar"?"انتهت صلاحية الرابط":r==="tr"?"Bağlantı Süresi Doldu":"Link Expired",description:r==="ar"?"انتهت صلاحية رابط إعادة التعيين. يرجى طلب رابط جديد.":r==="tr"?"Sıfırlama bağlantısının süresi doldu. Lütfen yeni bir bağlantı isteyin.":"Reset link has expired. Please request a new one.",variant:"destructive"}):a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"رابط إعادة التعيين غير صالح":r==="tr"?"Geçersiz sıfırlama bağlantısı":"Invalid reset link",variant:"destructive"}),setTimeout(()=>n("/forgot-password"),3e3);else{console.log("Session set successfully:",k);const{data:T,error:U}=await h.auth.getUser();U||!T.user?(console.error("User verification failed:",U),a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"فشل في التحقق من الجلسة":r==="tr"?"Oturum doğrulaması başarısız":"Session verification failed",variant:"destructive"}),setTimeout(()=>n("/forgot-password"),3e3)):(console.log("User verified successfully:",T.user.email),i(!0),window.location.hash&&window.history.replaceState(null,"",window.location.pathname+window.location.search))}}catch(k){console.error("Error setting session:",k),a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"حدث خطأ في معالجة الرابط":r==="tr"?"Bağlantı işlenirken hata oluştu":"Error processing the link",variant:"destructive"}),setTimeout(()=>n("/forgot-password"),3e3)}else{console.log("Reset Password - Missing or invalid URL parameters:",{hasAccessToken:!!y,hasRefreshToken:!!c,type:N,expectedType:"recovery"});const{data:k}=await h.auth.getUser();if(k.user){console.log("User is already authenticated, allowing password reset"),i(!0);return}a({title:r==="ar"?"رابط غير صالح":r==="tr"?"Geçersiz Bağlantı":"Invalid Link",description:r==="ar"?"رابط إعادة التعيين غير صالح أو منتهي الصلاحية. يرجى طلب رابط جديد.":r==="tr"?"Sıfırlama bağlantısı geçersiz veya süresi dolmuş. Lütfen yeni bir bağlantı isteyin.":"Reset link is invalid or expired. Please request a new one.",variant:"destructive"}),setTimeout(()=>{n("/forgot-password")},4e3)}})()},[p,n,a,r]),{password:s,setPassword:o,confirmPassword:t,setConfirmPassword:d,showPassword:g,setShowPassword:b,loading:x,isValidSession:m,handleResetPassword:async L=>{if(L.preventDefault(),!m){a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"جلسة غير صالحة":r==="tr"?"Geçersiz oturum":"Invalid session",variant:"destructive"});return}if(!s||!t){a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"يرجى ملء جميع الحقول":r==="tr"?"Lütfen tüm alanları doldurun":"Please fill in all fields",variant:"destructive"});return}if(s!==t){a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"كلمات المرور غير متطابقة":r==="tr"?"Şifreler eşleşmiyor":"Passwords do not match",variant:"destructive"});return}if(s.length<8){a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"كلمة المرور يجب أن تكون 8 أحرف على الأقل":r==="tr"?"Şifre en az 8 karakter olmalıdır":"Password must be at least 8 characters",variant:"destructive"});return}const v=/[A-Z]/.test(s),w=/[a-z]/.test(s),y=/\d/.test(s);if(!v||!w||!y){a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"كلمة المرور يجب أن تحتوي على أحرف كبيرة وصغيرة وأرقام":r==="tr"?"Şifre büyük harf, küçük harf ve rakam içermelidir":"Password must contain uppercase, lowercase letters and numbers",variant:"destructive"});return}l(!0);try{const{error:c}=await h.auth.updateUser({password:s});c?(console.error("Update password error:",c),a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"حدث خطأ أثناء إعادة تعيين كلمة المرور":r==="tr"?"Şifre sıfırlanırken hata oluştu":"Error resetting password",variant:"destructive"})):(a({title:r==="ar"?"تم بنجاح":r==="tr"?"Başarılı":"Success",description:r==="ar"?"تم إعادة تعيين كلمة المرور بنجاح":r==="tr"?"Şifre başarıyla sıfırlandı":"Password reset successfully"}),n("/login"))}catch(c){console.error("Reset password error:",c),a({title:r==="ar"?"خطأ":r==="tr"?"Hata":"Error",description:r==="ar"?"حدث خطأ غير متوقع":r==="tr"?"Beklenmeyen bir hata oluştu":"An unexpected error occurred",variant:"destructive"})}finally{l(!1)}}}},W=()=>{const[r]=D(),[a,n]=u.useState({}),[p,x]=u.useState({});u.useEffect(()=>{(async()=>{const o=new URLSearchParams(window.location.hash.substring(1)),t=r,d={fullUrl:window.location.href,hash:window.location.hash,search:window.location.search,hashParams:Object.fromEntries(o.entries()),queryParams:Object.fromEntries(t.entries()),tokens:{accessToken:o.get("access_token")||t.get("access_token"),refreshToken:o.get("refresh_token")||t.get("refresh_token"),type:o.get("type")||t.get("type")}};n(d);try{const{data:g,error:b}=await h.auth.getSession(),{data:m,error:i}=await h.auth.getUser();x({session:g.session?"Active":"None",sessionError:b==null?void 0:b.message,user:m.user?m.user.email:"None",userError:i==null?void 0:i.message,isAuthenticated:!!m.user})}catch(g){x({error:g.message})}})()},[r]);const l=async()=>{const{accessToken:s,refreshToken:o}=a.tokens||{};if(!s||!o){alert("No tokens available to test");return}try{const{data:t,error:d}=await h.auth.setSession({access_token:s,refresh_token:o});console.log("Set session result:",{data:t,error:d}),alert(`Set session result: ${d?"Error: "+d.message:"Success"}`)}catch(t){console.error("Set session error:",t),alert("Set session error: "+t.message)}};return e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs(S,{children:[e.jsx(q,{children:e.jsx(B,{children:"Reset Password Debug Info"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"URL Information:"}),e.jsx("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto",children:JSON.stringify(a,null,2)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Session Information:"}),e.jsx("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto",children:JSON.stringify(p,null,2)})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(P,{onClick:l,variant:"outline",children:"Test Set Session"}),e.jsx(P,{onClick:()=>window.location.reload(),variant:"outline",children:"Reload Page"})]})]})]})})},ae=()=>{const{currentLanguage:r}=_(),{password:a,setPassword:n,confirmPassword:p,setConfirmPassword:x,showPassword:l,setShowPassword:s,loading:o,isValidSession:t,handleResetPassword:d}=M(),g=()=>r==="ar"?"إعادة تعيين كلمة المرور":r==="tr"?"Şifre Sıfırla":"Reset Password",b=()=>r==="ar"?"أدخل كلمة المرور الجديدة الخاصة بك":r==="tr"?"Yeni şifrenizi girin":"Enter your new password",m=window.location.search.includes("debug=true");return t?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 py-24 relative overflow-hidden transition-all duration-500",style:{background:`
          linear-gradient(135deg,
            color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 3%, transparent),
            color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 2%, transparent)
          ),
          linear-gradient(to bottom right,
            #fafbff 0%,
            #f1f5f9 50%,
            #e2e8f0 100%
          )
        `,...typeof window<"u"&&document.documentElement.classList.contains("dark")&&{background:`
            linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent),
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 5%, transparent)
            ),
            linear-gradient(to bottom right,
              #0f172a 0%,
              #1e293b 50%,
              #334155 100%
            )
          `}},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-5 dark:opacity-10",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent) 0%,
              transparent 50%,
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 5%, transparent) 100%
            )`}}),e.jsx("div",{className:"absolute top-20 left-20 w-64 h-64 rounded-full blur-3xl animate-pulse opacity-10 dark:opacity-15",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent),
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 6%, transparent)
            )`}}),e.jsx("div",{className:"absolute bottom-20 right-20 w-80 h-80 rounded-full blur-3xl animate-pulse delay-1000 opacity-8 dark:opacity-12",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 6%, transparent),
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 5%, transparent)
            )`}}),e.jsx("div",{className:"absolute top-1/2 left-1/4 w-48 h-48 rounded-full blur-2xl animate-pulse delay-500 opacity-8 dark:opacity-12",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 6%, transparent),
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 5%, transparent)
            )`}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-16 left-16 animate-float opacity-15 dark:opacity-25",children:e.jsx(f,{className:"w-8 h-8",style:{color:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 40%, transparent)"}})}),e.jsx("div",{className:"absolute top-32 right-24 animate-float-delayed opacity-12 dark:opacity-20",children:e.jsx(f,{className:"w-6 h-6",style:{color:"color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 35%, transparent)"}})}),e.jsx("div",{className:"absolute bottom-24 left-32 animate-float-slow opacity-10 dark:opacity-18",children:e.jsx(f,{className:"w-10 h-10",style:{color:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 30%, transparent)"}})}),e.jsx("div",{className:"absolute bottom-40 right-16 animate-float-delayed-slow opacity-8 dark:opacity-15",children:e.jsx(f,{className:"w-7 h-7",style:{color:"color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 25%, transparent)"}})}),e.jsx("div",{className:"absolute top-1/2 right-1/4 animate-float opacity-6 dark:opacity-12",children:e.jsx(f,{className:"w-5 h-5",style:{color:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 20%, transparent)"}})})]}),e.jsx("div",{className:"absolute top-32 right-1/4 w-3 h-3 rounded-full animate-bounce opacity-20 dark:opacity-30",style:{background:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 25%, transparent)"}}),e.jsx("div",{className:"absolute bottom-40 left-1/3 w-2 h-2 rounded-full animate-bounce delay-300 opacity-15 dark:opacity-25",style:{background:"color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 20%, transparent)"}}),e.jsx("div",{className:"absolute top-2/3 right-1/3 w-1 h-1 rounded-full animate-ping delay-700 opacity-25 dark:opacity-35",style:{background:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 30%, transparent)"}}),e.jsx("div",{className:"absolute top-10 right-10 w-32 h-32 rounded-full blur-2xl animate-pulse delay-200 opacity-5 dark:opacity-8",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 5%, transparent),
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 4%, transparent)
            )`}}),e.jsx("div",{className:"absolute bottom-32 left-10 w-40 h-40 rounded-full blur-3xl animate-pulse delay-800 opacity-4 dark:opacity-6",style:{background:`linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 4%, transparent),
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 3%, transparent)
            )`}})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs(S,{className:"backdrop-blur-xl bg-white/90 dark:bg-slate-800/90 border border-white/30 dark:border-slate-700/50 shadow-xl rounded-3xl transition-all duration-300 hover:shadow-2xl",children:[e.jsxs(q,{className:"text-center pt-12 pb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-xl ring-4 ring-blue-500/10 dark:ring-blue-400/20",style:{background:"linear-gradient(135deg, var(--brand-gradient-from-color, #ec489a) 0%, var(--brand-gradient-to-color, #f43f5e) 100%)"},children:e.jsx(f,{className:"w-10 h-10 text-white"})}),e.jsx(B,{className:"text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent dark:from-gray-100 dark:to-gray-400",children:g()}),e.jsx(Y,{className:"text-lg text-slate-600 dark:text-slate-300 mt-2 leading-relaxed",children:b()})]}),e.jsx(E,{className:"px-8 pb-12",children:e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"password",className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:r==="ar"?"كلمة المرور الجديدة":r==="tr"?"Yeni Şifre":"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 dark:text-slate-500 w-5 h-5"}),e.jsx(I,{id:"password",type:l?"text":"password",placeholder:r==="ar"?"أدخل كلمة المرور الجديدة":r==="tr"?"Yeni şifrenizi girin":"Enter your new password",className:"pl-10 pr-10 h-12 rounded-xl border-slate-200 dark:border-slate-600 bg-white/80 dark:bg-slate-700/80 backdrop-blur-sm focus:border-blue-500 dark:focus:border-blue-400 focus:ring-blue-500/20 dark:focus:ring-blue-400/20 text-slate-900 dark:text-slate-100 placeholder:text-slate-500 dark:placeholder:text-slate-400 transition-all duration-300",value:a,onChange:i=>n(i.target.value),required:!0,disabled:o}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors duration-200",onClick:()=>s(!l),children:l?e.jsx(F,{className:"w-5 h-5"}):e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"confirmPassword",className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:r==="ar"?"تأكيد كلمة المرور":r==="tr"?"Şifreyi Onayla":"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 dark:text-slate-500 w-5 h-5"}),e.jsx(I,{id:"confirmPassword",type:l?"text":"password",placeholder:r==="ar"?"أعد إدخال كلمة المرور":r==="tr"?"Şifrenizi tekrar girin":"Confirm your password",className:"pl-10 h-12 rounded-xl border-slate-200 dark:border-slate-600 bg-white/80 dark:bg-slate-700/80 backdrop-blur-sm focus:border-blue-500 dark:focus:border-blue-400 focus:ring-blue-500/20 dark:focus:ring-blue-400/20 text-slate-900 dark:text-slate-100 placeholder:text-slate-500 dark:placeholder:text-slate-400 transition-all duration-300",value:p,onChange:i=>x(i.target.value),required:!0,disabled:o})]})]}),e.jsxs(P,{type:"submit",className:"w-full h-12 rounded-xl text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] hover:brightness-95",disabled:o,style:{background:"linear-gradient(135deg, var(--brand-gradient-from-color, #ec489a) 0%, var(--brand-gradient-to-color, #f43f5e) 100%)"},children:[o?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,r==="ar"?"إعادة تعيين كلمة المرور":r==="tr"?"Şifreyi Sıfırla":"Reset Password"]})]})})]})}),m&&e.jsx("div",{className:"fixed bottom-4 right-4 max-w-md z-50",children:e.jsx(W,{})})]}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 py-24 relative overflow-hidden transition-all duration-500",style:{background:`
            linear-gradient(135deg,
              color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 3%, transparent),
              color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 2%, transparent)
            ),
            linear-gradient(to bottom right,
              #fafbff 0%,
              #f1f5f9 50%,
              #e2e8f0 100%
            )
          `,...typeof window<"u"&&document.documentElement.classList.contains("dark")&&{background:`
              linear-gradient(135deg,
                color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent),
                color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 5%, transparent)
              ),
              linear-gradient(to bottom right,
                #0f172a 0%,
                #1e293b 50%,
                #334155 100%
              )
            `}},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-5 dark:opacity-10",style:{background:`linear-gradient(135deg,
                color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent) 0%,
                transparent 50%,
                color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 5%, transparent) 100%
              )`}}),e.jsx("div",{className:"absolute top-20 left-20 w-64 h-64 rounded-full blur-3xl animate-pulse opacity-10 dark:opacity-15",style:{background:`linear-gradient(135deg,
                color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 8%, transparent),
                color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 6%, transparent)
              )`}}),e.jsx("div",{className:"absolute bottom-20 right-20 w-80 h-80 rounded-full blur-3xl animate-pulse delay-1000 opacity-8 dark:opacity-12",style:{background:`linear-gradient(135deg,
                color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 6%, transparent),
                color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 5%, transparent)
              )`}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-16 left-16 animate-float opacity-15 dark:opacity-25",children:e.jsx(f,{className:"w-8 h-8",style:{color:"color-mix(in srgb, var(--brand-gradient-from-color, #ec489a) 40%, transparent)"}})}),e.jsx("div",{className:"absolute bottom-24 right-32 animate-float-delayed opacity-12 dark:opacity-20",children:e.jsx(f,{className:"w-6 h-6",style:{color:"color-mix(in srgb, var(--brand-gradient-to-color, #f43f5e) 35%, transparent)"}})})]})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsx(S,{className:"backdrop-blur-xl bg-white/95 dark:bg-slate-800/95 border border-white/40 dark:border-slate-700/60 shadow-xl rounded-3xl transition-all duration-300",children:e.jsxs(E,{className:"px-8 py-12 text-center",children:[e.jsx(G,{className:"w-12 h-12 animate-spin mx-auto mb-4",style:{color:"var(--brand-gradient-from-color, #ec489a)"}}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:r==="ar"?"جاري التحقق من الرابط...":r==="tr"?"Bağlantı doğrulanıyor...":"Verifying link..."}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:r==="ar"?"يرجى الانتظار":r==="tr"?"Lütfen bekleyin":"Please wait"})]})})})]})};export{ae as default};
