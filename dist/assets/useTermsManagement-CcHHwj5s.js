import{r as o,G as y,u as h,s as n}from"./index-Ba-_IHuQ.js";const q=()=>{const[_,v]=o.useState([]),[m,u]=o.useState(!0),[p,d]=o.useState(!1),[c,l]=o.useState(!1),{toast:r}=y(),{user:a}=h();o.useEffect(()=>{(async()=>{if(!a){l(!1);return}try{const{data:t,error:i}=await n.rpc("is_admin");i?(console.error("Error checking admin status:",i),l(!1)):l(t===!0)}catch(t){console.error("Error checking admin status:",t),l(!1)}})()},[a]);const s=async()=>{try{u(!0);const{data:e,error:t}=await n.from("terms_and_conditions").select("*").order("created_at",{ascending:!1});if(t){console.error("Error fetching terms:",t),r({title:"خطأ",description:"فشل في تحميل الشروط والأحكام",variant:"destructive"});return}v(e||[])}catch(e){console.error("Error fetching terms:",e),r({title:"خطأ",description:"فشل في تحميل الشروط والأحكام",variant:"destructive"})}finally{u(!1)}},g=async()=>{try{const{data:e,error:t}=await n.from("terms_and_conditions").select("*").eq("is_active",!0).single();return t?(console.error("Error fetching active terms:",t),null):e}catch(e){return console.error("Error fetching active terms:",e),null}};return o.useEffect(()=>{s()},[]),{terms:_,loading:m,submitting:p,isAdmin:c,user:a,addTerms:async e=>{if(!c)return r({title:"خطأ",description:"ليس لديك صلاحية لحفظ الشروط والأحكام",variant:"destructive"}),!1;if(!a)return r({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"}),!1;try{d(!0);const t={title_ar:e.title_ar,title_en:e.title_en,title_tr:e.title_tr,content_ar:e.content_ar,content_en:e.content_en,content_tr:e.content_tr,is_active:e.is_active,created_by:a.id},{error:i}=await n.from("terms_and_conditions").insert([t]);return i?(console.error("Error saving terms:",i),r({title:"خطأ",description:"فشل في حفظ الشروط والأحكام",variant:"destructive"}),!1):(r({title:"نجح",description:"تم حفظ الشروط والأحكام بنجاح"}),s(),!0)}catch(t){return console.error("Error saving terms:",t),r({title:"خطأ",description:"فشل في حفظ الشروط والأحكام",variant:"destructive"}),!1}finally{d(!1)}},updateTerms:async(e,t)=>{if(!c)return r({title:"خطأ",description:"ليس لديك صلاحية لتحديث الشروط والأحكام",variant:"destructive"}),!1;try{d(!0);const i={title_ar:t.title_ar,title_en:t.title_en,title_tr:t.title_tr,content_ar:t.content_ar,content_en:t.content_en,content_tr:t.content_tr,is_active:t.is_active},{error:f}=await n.from("terms_and_conditions").update(i).eq("id",e);return f?(console.error("Error updating terms:",f),r({title:"خطأ",description:"فشل في تحديث الشروط والأحكام",variant:"destructive"}),!1):(r({title:"نجح",description:"تم تحديث الشروط والأحكام بنجاح"}),s(),!0)}catch(i){return console.error("Error updating terms:",i),r({title:"خطأ",description:"فشل في تحديث الشروط والأحكام",variant:"destructive"}),!1}finally{d(!1)}},deleteTerms:async e=>{if(!c){r({title:"خطأ",description:"ليس لديك صلاحية لحذف الشروط والأحكام",variant:"destructive"});return}try{const{error:t}=await n.from("terms_and_conditions").delete().eq("id",e);if(t){console.error("Error deleting terms:",t),r({title:"خطأ",description:"فشل في حذف الشروط والأحكام",variant:"destructive"});return}r({title:"نجح",description:"تم حذف الشروط والأحكام بنجاح"}),s()}catch(t){console.error("Error deleting terms:",t),r({title:"خطأ",description:"فشل في حذف الشروط والأحكام",variant:"destructive"})}},toggleActiveStatus:async(e,t)=>{if(!c){r({title:"خطأ",description:"ليس لديك صلاحية لتفعيل الشروط والأحكام",variant:"destructive"});return}try{t||await n.from("terms_and_conditions").update({is_active:!1}).neq("id","dummy");const{error:i}=await n.from("terms_and_conditions").update({is_active:!t}).eq("id",e);if(i){console.error("Error toggling terms status:",i),r({title:"خطأ",description:"فشل في تفعيل الشروط والأحكام",variant:"destructive"});return}r({title:"نجح",description:t?"تم إلغاء تفعيل الشروط والأحكام":"تم تفعيل الشروط والأحكام بنجاح"}),s()}catch(i){console.error("Error toggling terms status:",i),r({title:"خطأ",description:"فشل في تفعيل الشروط والأحكام",variant:"destructive"})}},fetchTerms:s,fetchActiveTerms:g}};export{q as u};
