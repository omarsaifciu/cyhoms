import{c as V,a as f,j as e,r as p,u as I,G as D,N as me,O as ue,Q as he,I as w,X as G,s as S,W as E,U as xe,al as Q,aw as M,L as pe,V as ge,ax as fe}from"./index-Ba-_IHuQ.js";import{C as L,b as X,c as be,d as ye}from"./card-DocFJD5R.js";import{B as je}from"./badge-DRGEcZbO.js";import{U as q,S as O}from"./switch-CCSj0eWM.js";import{C as Z}from"./circle-check-big-D_hgqrRM.js";import{C as ve}from"./clock-Fq3ibpDw.js";import{C as Ne}from"./calendar-BZmh3iBK.js";import{f as ke}from"./format-D93D0hPk.js";import{L as C}from"./label-3yzes-iA.js";import{I as R}from"./input-BB7eCBwl.js";import{S as J,a as K,b as Y,c as ee,d as _}from"./select-B0LLBn5t.js";import{a as we,S as _e}from"./settings-BehK2Pjf.js";import{C as F}from"./circle-alert-DRhy0Vr1.js";import{R as re}from"./refresh-cw-Dzle1iAu.js";import{A as Se}from"./arrow-right-Bj_z4KDd.js";import{A as Ue}from"./arrow-left-YqLAbwqU.js";import"./en-US-ZBLZOCkG.js";/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],Pe=V("bell-off",Ce);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ee=V("camera",Ae),Fe=()=>{const{t:r}=f();return e.jsxs("div",{className:"text-center mb-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:r("profile")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-200",children:r("personalInfo")})]})},Ie=({currentAvatarUrl:r,userName:s,onAvatarUpdate:a})=>{const[t,n]=p.useState(!1),[c,m]=p.useState(null),{user:o}=I(),{toast:i}=D(),b=()=>{if(!s)return"??";const l=s.split(" ").filter(Boolean);return l.length>1?`${l[0][0]}${l[l.length-1][0]}`.toUpperCase():s.slice(0,2).toUpperCase()},k=l=>{var x;const d=(x=l.target.files)==null?void 0:x[0];if(!d)return;if(!d.type.startsWith("image/")){i({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"});return}if(d.size>5*1024*1024){i({title:"خطأ",description:"حجم الملف كبير جداً. الحد الأقصى 5 ميجابايت",variant:"destructive"});return}const u=new FileReader;u.onload=g=>{var N;m((N=g.target)==null?void 0:N.result)},u.readAsDataURL(d),y(d)},y=async l=>{if(o){n(!0);try{const d=l.name.split(".").pop(),u=`${o.id}/avatar.${d}`;if(console.log("Uploading avatar:",u),r){const U=r.split("/").pop();U&&await S.storage.from("avatars").remove([`${o.id}/${U}`])}const{error:x}=await S.storage.from("avatars").upload(u,l,{upsert:!0,contentType:l.type});if(x)throw console.error("Upload error:",x),x;const{data:{publicUrl:g}}=S.storage.from("avatars").getPublicUrl(u);console.log("Avatar uploaded successfully:",g);const{error:N}=await S.from("profiles").update({avatar_url:g}).eq("id",o.id);if(N)throw console.error("Profile update error:",N),N;a(g),m(null),i({title:"تم بنجاح",description:"تم تحديث الصورة الشخصية بنجاح"})}catch(d){console.error("Error uploading avatar:",d),i({title:"خطأ",description:"فشل في رفع الصورة. يرجى المحاولة مرة أخرى",variant:"destructive"}),m(null)}finally{n(!1)}}},h=async()=>{if(!(!o||!r)){n(!0);try{console.log("Removing avatar...");const l=r.split("/").pop();l&&await S.storage.from("avatars").remove([`${o.id}/${l}`]);const{error:d}=await S.from("profiles").update({avatar_url:null}).eq("id",o.id);if(d)throw console.error("Profile update error:",d),d;a(""),i({title:"تم بنجاح",description:"تم حذف الصورة الشخصية بنجاح"})}catch(l){console.error("Error removing avatar:",l),i({title:"خطأ",description:"فشل في حذف الصورة. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{n(!1)}}};return e.jsxs("div",{className:"relative group",children:[e.jsxs(me,{className:"w-24 h-24 ring-4 ring-brand-accent-light transition-all duration-300 hover:ring-brand-accent-light-hover",children:[e.jsx(ue,{src:c||r}),e.jsx(he,{className:"text-white text-xl bg-gradient-to-br from-brand-gradient-from to-brand-gradient-to",children:b()})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"hidden",id:"avatar-upload",disabled:t}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(w,{size:"sm",variant:"secondary",className:"rounded-full p-2 h-8 w-8",disabled:t,asChild:!0,children:e.jsx("span",{className:"cursor-pointer",children:t?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4"})})})}),r&&e.jsx(w,{size:"sm",variant:"destructive",className:"rounded-full p-2 h-8 w-8",onClick:h,disabled:t,children:e.jsx(G,{className:"w-4 h-4"})})]})}),t&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-white animate-spin"})})]})},Le=({profile:r,user:s,onAvatarUpdate:a})=>{var c;const{t}=f(),n=()=>{var i;const o=(r.full_name||((i=s==null?void 0:s.email)==null?void 0:i.split("@")[0])||"User").trim();return o.length>=2?o.substring(0,2).toUpperCase():o.length===1?o.toUpperCase()+"U":"US"};return e.jsx(L,{className:`animate-scale-in hover-scale transition-all duration-300 hover:shadow-xl border-0 
      bg-white dark:bg-[#181926] dark:border-none dark:backdrop-blur-0 backdrop-blur-0`,children:e.jsx(X,{className:"p-6 dark:text-gray-100 text-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(Ie,{currentAvatarUrl:r.avatar_url||void 0,userName:n(),onAvatarUpdate:a})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 dark:text-gray-100 text-gray-900",children:r.full_name||((c=s==null?void 0:s.email)==null?void 0:c.split("@")[0])}),r.username&&e.jsxs("p",{className:"mb-2 dark:text-gray-300 text-gray-500",children:["@",r.username]}),e.jsx("p",{className:"mb-4 dark:text-gray-200 text-gray-600",children:s==null?void 0:s.email}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(je,{variant:r.is_approved?"default":"secondary",className:`flex items-center gap-2 transition-all duration-300 ${r.is_approved?"bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900 dark:text-green-300":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200 dark:bg-yellow-950 dark:text-yellow-200"}`,children:[r.is_approved?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),r.is_approved?t("approved"):t("pending")]})}),r.created_at&&e.jsxs("div",{className:"flex items-center justify-center text-sm dark:text-gray-300 text-gray-600",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),t("memberSince")," ",ke(new Date(r.created_at),"MMM yyyy")]})]})]})})})},Re=(r,s)=>!r||r.trim()===""?{isValid:!1,error:s==="ar"?"اسم المستخدم مطلوب":"Username is required"}:/^[a-zA-Z0-9_]+$/.test(r)?r.length<3?{isValid:!1,error:s==="ar"?"اسم المستخدم يجب أن يكون 3 أحرف على الأقل":"Username must be at least 3 characters long"}:r.length>20?{isValid:!1,error:s==="ar"?"اسم المستخدم يجب أن يكون أقل من 20 حرف":"Username must be less than 20 characters"}:{isValid:!0}:{isValid:!1,error:s==="ar"?"اسم المستخدم يمكن أن يحتوي فقط على أحرف وأرقام وشرطة سفلية":"Username can only contain letters, numbers, and underscores"},Te=r=>{const{user:s}=I(),{currentLanguage:a}=f(),[t,n]=p.useState(null),[c,m]=p.useState(!1),[o,i]=p.useState(!1);return{usernameError:t,isChecking:c,isValid:o,validateUsername:(y,h)=>{const l=Re(y,a);return l.isValid?(n(null),i(!0),h==null||h(!0),!0):(n(l.error||null),i(!1),h==null||h(!1,l.error),!1)},checkUsernameAvailability:async y=>{if(y.toLowerCase()===(r==null?void 0:r.toLowerCase()))return n(null),i(!0),!0;m(!0);try{const{data:h,error:l}=await S.from("profiles").select("username").ilike("username",y).neq("id",s==null?void 0:s.id);return l?(console.error("Error checking username availability:",l),n(a==="ar"?"خطأ في التحقق من توفر اسم المستخدم":"Error checking username availability"),i(!1),!1):h&&h.length>0?(n(a==="ar"?"اسم المستخدم مستخدم من قبل مستخدم آخر":"Username is already taken"),i(!1),!1):(n(null),i(!0),!0)}catch(h){return console.error("Error checking username availability:",h),n(a==="ar"?"خطأ في التحقق من توفر اسم المستخدم":"Error checking username availability"),i(!1),!1}finally{m(!1)}},setUsernameError:n,setIsValid:i}},$e=({isChecking:r,usernameError:s,isValid:a,value:t})=>{const{currentLanguage:n}=f();return e.jsxs("div",{className:"space-y-1",children:[r&&e.jsxs("p",{className:"text-sm text-blue-600 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 animate-spin"}),n==="ar"?"جاري التحقق من توفر الاسم...":"Checking availability..."]}),s&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),s]}),!s&&!r&&t&&t.trim()!==""&&a&&e.jsxs("p",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),n==="ar"?"اسم المستخدم متوفر!":"Username is available!"]}),e.jsx("p",{className:"text-xs text-gray-500",children:n==="ar"?"يمكن استخدام الأحرف والأرقام والشرطة السفلية فقط (3-20 حرف، مطلوب)":"Only letters, numbers, and underscores allowed (3-20 characters, required)"})]})},Me=({value:r,onChange:s,isEditing:a,currentUsername:t,onValidationChange:n})=>{const{currentLanguage:c}=f(),{usernameError:m,isChecking:o,isValid:i,validateUsername:b,checkUsernameAvailability:k}=Te(t),y=async h=>{if(s(h),!b(h,n))return;const l=setTimeout(async()=>{const d=await k(h);n==null||n(d,d?void 0:m||void 0)},500);return()=>clearTimeout(l)};return p.useEffect(()=>{if(r)b(r,n);else{const h=c==="ar"?"اسم المستخدم مطلوب":"Username is required";n==null||n(!1,h)}},[r,c]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"username",className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:[c==="ar"?"اسم المستخدم":"Username"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),a?e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{id:"username",value:r,onChange:h=>y(h.target.value),className:`transition-all duration-300 focus:ring-2 ${m?"border-red-500 focus:ring-red-500":i&&r&&!o?"border-green-500 focus:ring-green-500":"border-gray-200 focus:ring-pink-500"} 
              dark:bg-[#23263a] dark:text-gray-100 dark:placeholder:text-gray-400 dark:border-[#23263a]
              `,placeholder:c==="ar"?"أدخل اسم المستخدم":"Enter username"}),e.jsx($e,{isChecking:o,usernameError:m,isValid:i,value:r})]})}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#23263a] dark:text-gray-100 rounded-lg text-gray-900 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-[#23263a]",children:r?`@${r}`:"-"})]})},W=({id:r,label:s,value:a,onChange:t,placeholder:n,isEditing:c,error:m,isRequired:o=!1})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:r,className:`text-sm font-medium
        text-gray-700
        dark:text-gray-100`,children:[s," ",o&&e.jsx("span",{className:"text-red-500",children:"*"})]}),c?e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{id:r,value:a,onChange:i=>t(i.target.value),className:`transition-all duration-300 focus:ring-2 ${m?"border-red-500 focus:ring-red-500":"border-gray-200 focus:ring-pink-500"} 
            dark:bg-[#23263a] dark:text-gray-100 dark:placeholder:text-gray-400 dark:border-[#23263a]
            `,placeholder:n}),m&&e.jsx("p",{className:"text-sm text-red-600",children:m})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#23263a] dark:text-gray-100 rounded-lg text-gray-900 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-[#23263a]",children:a||"-"})]}),qe=({label:r,value:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:r}),e.jsx("div",{className:`
          p-3
          bg-gray-50
          text-gray-900
          rounded-lg
          transition-all
          duration-300
          hover:bg-gray-100
          dark:bg-[#23263a]
          dark:text-gray-100
          dark:hover:bg-[#23263a]
        `,children:s||"-"})]}),Oe=({value:r,onChange:s,isEditing:a})=>{const{t,currentLanguage:n}=f(),c=m=>{switch(m){case"client":return t("client");case"agent":return t("seller");case"property_owner":return t("property_owner");case"real_estate_office":return n==="ar"?"مكتب عقارات":n==="tr"?"Emlak Ofisi":"Real Estate Office";case"partner_and_site_owner":return t("partner_and_site_owner")||"شريك ومالك الموقع";case"support":return n==="ar"?"دعم فني":n==="tr"?"Destek":"Support";default:return m}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:t("userType")}),a?e.jsxs(J,{value:r,onValueChange:s,children:[e.jsx(K,{className:"transition-all duration-300 focus:ring-2 focus:ring-pink-500 border-gray-200 dark:bg-[#23263a] dark:text-gray-100 dark:border-[#23263a] dark:placeholder:text-gray-400",children:e.jsx(Y,{})}),e.jsxs(ee,{className:"dark:bg-[#23263a] dark:text-gray-100",children:[e.jsx(_,{value:"client",children:t("client")}),e.jsx(_,{value:"agent",children:t("seller")}),e.jsx(_,{value:"property_owner",children:t("property_owner")}),e.jsx(_,{value:"real_estate_office",children:n==="ar"?"مكتب عقارات":n==="tr"?"Emlak Ofisi":"Real Estate Office"}),e.jsx(_,{value:"support",children:n==="ar"?"دعم فني":n==="tr"?"Destek":"Support"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#23263a] dark:text-gray-100 rounded-lg text-gray-900 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-[#23263a]",children:c(r)})]})},We=({value:r,onChange:s,isEditing:a})=>{const{t}=f(),n=c=>{switch(c){case"ar":return t("arabic");case"en":return t("english");case"tr":return t("turkish");default:return c}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:t("languagePreference")}),a?e.jsxs(J,{value:r,onValueChange:s,children:[e.jsx(K,{className:"transition-all duration-300 focus:ring-2 focus:ring-pink-500 border-gray-200 dark:bg-[#23263a] dark:text-gray-100 dark:border-[#23263a] dark:placeholder:text-gray-400",children:e.jsx(Y,{})}),e.jsxs(ee,{className:"dark:bg-[#23263a] dark:text-gray-100",children:[e.jsx(_,{value:"ar",children:t("arabic")}),e.jsx(_,{value:"en",children:t("english")}),e.jsx(_,{value:"tr",children:t("turkish")})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#23263a] dark:text-gray-100 rounded-lg text-gray-900 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-[#23263a]",children:n(r)})]})},Be=({value:r,onChange:s,isEditing:a,error:t,isRequired:n=!1})=>{const{currentLanguage:c}=f(),m=()=>{switch(c){case"ar":return"رقم الواتساب";case"tr":return"WhatsApp Numarası";default:return"WhatsApp Number"}},o=()=>{switch(c){case"ar":return"رقم الواتساب";case"tr":return"WhatsApp numaranız";default:return"WhatsApp number"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"whatsapp",className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:[m()," ",n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a?e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{id:"whatsapp",value:r,onChange:i=>s(i.target.value),className:`transition-all duration-300 focus:ring-2 ${t?"border-red-500 focus:ring-red-500":"border-gray-200 focus:ring-pink-500"} 
            dark:bg-[#23263a] dark:text-gray-100 dark:placeholder:text-gray-400 dark:border-[#23263a]
            `,placeholder:o()}),t&&e.jsx("p",{className:"text-sm text-red-600",children:t})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#23263a] dark:text-gray-100 rounded-lg text-gray-900 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-[#23263a]",children:r||"-"})]})},B=(r,s)=>!r||r.trim()===""?{isValid:!1,error:s==="ar"?"الاسم الكامل مطلوب":"Full name is required"}:r.trim().length<2?{isValid:!1,error:s==="ar"?"الاسم يجب أن يكون حرفين على الأقل":"Name must be at least 2 characters"}:{isValid:!0},z=(r,s)=>!r||r.trim()===""?{isValid:!1,error:s==="ar"?"رقم الهاتف مطلوب":"Phone number is required"}:/^[\+]?[1-9][\d]{0,15}$/.test(r.replace(/\s/g,""))?{isValid:!0}:{isValid:!1,error:s==="ar"?"رقم الهاتف غير صحيح":"Invalid phone number"},H=(r,s)=>!r||r.trim()===""?{isValid:!1,error:s==="ar"?"رقم الواتساب مطلوب":"WhatsApp number is required"}:/^[\+]?[1-9][\d]{0,15}$/.test(r.replace(/\s/g,""))?{isValid:!0}:{isValid:!1,error:s==="ar"?"رقم واتساب غير صحيح":"Invalid WhatsApp number"},ze=({formData:r,setFormData:s,isEditing:a,profile:t,user:n,onValidationChange:c})=>{const{t:m,currentLanguage:o}=f(),[i,b]=p.useState({}),k=["seller","property_owner","real_estate_office","partner_and_site_owner"].includes(r.user_type),y=(l,d)=>{s(N=>({...N,[l]:d}));let u=null;l==="full_name"?u=B(d,o).error||null:l==="phone"?u=z(d,o).error||null:l==="whatsapp_number"&&k&&(u=H(d,o).error||null);const x={...i};u?x[l]=u:delete x[l],b(x);const g=Object.keys(x).length===0;c==null||c(g,x)},h=(l,d)=>{const u={...i};!l&&d?u.username=d:delete u.username,b(u);const x=Object.keys(u).length===0;c==null||c(x,u)};return p.useEffect(()=>{if(a){const l={},d=B(r.full_name,o);!d.isValid&&d.error&&(l.full_name=d.error);const u=z(r.phone,o);if(!u.isValid&&u.error&&(l.phone=u.error),k){const g=H(r.whatsapp_number,o);!g.isValid&&g.error&&(l.whatsapp_number=g.error)}b(g=>({...g,...l}));const x={...i,...l};c==null||c(Object.keys(x).length===0,x)}},[a,r.full_name,r.phone,r.user_type,r.whatsapp_number,o]),r.theme_preference,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(W,{id:"fullName",label:m("fullName"),value:r.full_name,onChange:l=>y("full_name",l),placeholder:m("fullName"),isEditing:a,error:i.full_name,isRequired:!0}),e.jsx(Me,{value:r.username,onChange:l=>s(d=>({...d,username:l})),isEditing:a,currentUsername:t==null?void 0:t.username,onValidationChange:h}),e.jsx(qe,{label:m("email"),value:(n==null?void 0:n.email)||""}),e.jsx(W,{id:"phone",label:m("phone"),value:r.phone,onChange:l=>y("phone",l),placeholder:m("phone"),isEditing:a,error:i.phone,isRequired:!0}),k&&e.jsx(Be,{value:r.whatsapp_number,onChange:l=>y("whatsapp_number",l),isEditing:a,error:i.whatsapp_number,isRequired:!0}),e.jsx(Oe,{value:r.user_type,onChange:l=>s(d=>({...d,user_type:l})),isEditing:a}),e.jsx(We,{value:r.language_preference,onChange:l=>s(d=>({...d,language_preference:l})),isEditing:a})]})},He=()=>{const{t:r}=f();return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-brand-accent flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(be,{className:"text-xl sm:text-2xl truncate",children:r("personalInfo")}),e.jsx(ye,{className:"text-sm truncate",children:r("editProfile")})]})]})},Ve=({isEditing:r,setIsEditing:s,isSaving:a,isFormValid:t,onSave:n,onCancel:c})=>{const{t:m,currentLanguage:o}=f(),i=()=>{s(!0)};return r?e.jsxs("div",{className:"flex gap-2 w-full justify-end flex-wrap",children:[e.jsxs(w,{variant:"outline",onClick:c,className:"transition-all duration-300 hover:bg-gray-50 text-sm px-3 py-2 h-auto min-w-0 whitespace-nowrap order-2 sm:order-1",children:[e.jsx("span",{className:"hidden sm:inline",children:o==="ar"?"إلغاء":"Cancel"}),e.jsx("span",{className:"sm:hidden",children:"إلغاء"})]}),e.jsx(w,{onClick:n,disabled:a||!t,className:`bg-gradient-to-r text-white transition-all duration-300 transform hover:scale-105 text-sm px-3 py-2 h-auto min-w-0 whitespace-nowrap order-1 sm:order-2 ${t?"from-brand-gradient-from to-brand-gradient-to hover:brightness-95":"from-gray-400 to-gray-500 cursor-not-allowed"}`,children:a?e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:o==="ar"?"جاري الحفظ...":"Saving..."}),e.jsx("span",{className:"sm:hidden",children:"حفظ..."})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:m("saveChanges")}),e.jsx("span",{className:"sm:hidden",children:"حفظ"})]})})]}):e.jsx("div",{className:"flex justify-end w-full",children:e.jsxs(w,{onClick:i,className:"bg-gradient-to-r from-brand-gradient-from to-brand-gradient-to hover:brightness-95 text-white transition-all duration-300 transform hover:scale-105 text-sm px-3 py-2 h-auto min-w-0 whitespace-nowrap",children:[e.jsx(we,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:m("editProfile")}),e.jsx("span",{className:"sm:hidden",children:"تعديل"})]})})},De=({isEditing:r,isFormValid:s,validationErrors:a})=>{const{currentLanguage:t}=f();return!r||s||Object.keys(a).length===0?null:e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"w-4 h-4 text-red-500"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:t==="ar"?"يرجى إصلاح الأخطاء التالية:":"Please fix the following errors:"})]}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:Object.values(a).map((n,c)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-red-500 rounded-full"}),n]},c))})]})},Ge=({isEditing:r,setIsEditing:s,isSaving:a,formData:t,setFormData:n,profile:c,user:m,onSave:o,onCancel:i})=>{const[b,k]=p.useState(!0),[y,h]=p.useState({}),l=(u,x)=>{k(u),h(x)},d=()=>{b&&o()};return e.jsxs(L,{className:"animate-fade-in transition-all duration-300 hover:shadow-xl border-0 bg-white dark:bg-[#181926] dark:border-none dark:backdrop-blur-0 backdrop-blur-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 sm:p-6 pb-0 gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(He,{})}),e.jsx("div",{className:"flex-shrink-0 w-full sm:w-auto",children:e.jsx(Ve,{isEditing:r,setIsEditing:s,isSaving:a,isFormValid:b,onSave:d,onCancel:i})})]}),e.jsx(De,{isEditing:r,isFormValid:b,validationErrors:y}),e.jsx(X,{className:"p-4 sm:p-6 space-y-6 dark:text-gray-100 text-gray-900",children:e.jsx(ze,{formData:t,setFormData:n,isEditing:r,profile:c,user:m,onValidationChange:l})})]})};function ae(r,s){r(s),typeof window<"u"&&window.dispatchEvent(new Event("user-themed-changed-manually"))}const Qe=({value:r,onChange:s,isEditing:a=!0})=>{const{t,currentLanguage:n}=f(),{setTheme:c}=Q(),m=o=>{if(!a)return;const i=o?"dark":"light";s(i),ae(c,i)};return e.jsx(L,{className:`
        w-full max-w-md mx-auto 
        bg-white dark:bg-[#181926]
        shadow-lg border-0 rounded-lg
        animate-fade-in transition-all
        mt-8 sm:mt-14
        px-5 py-6
      `,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:n==="ar"?e.jsxs(e.Fragment,{children:[e.jsx(O,{checked:r==="dark",onCheckedChange:m,disabled:!a,"aria-label":t("toggleDarkMode"),className:"scale-110"}),e.jsx("span",{className:"block font-semibold text-base text-gray-900 dark:text-white",children:t("theme")})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"block font-semibold text-base text-gray-900 dark:text-white",children:t("theme")}),e.jsx(O,{checked:r==="dark",onCheckedChange:m,disabled:!a,"aria-label":t("toggleDarkMode"),className:"scale-110"})]})}),e.jsx("div",{className:"mt-3 block text-sm font-medium text-brand-accent dark:text-brand-accent text-center",children:t(r==="dark"?"darkMode":"lightMode")})]})})},Xe=()=>{const{t:r}=f();return e.jsx("div",{className:`
        min-h-screen pt-24 flex items-center justify-center
        bg-gradient-to-br
        from-brand-gradient-from-light to-brand-gradient-to-light
        dark:bg-[#222636] dark:from-none dark:to-none
      `,children:e.jsxs("div",{className:"animate-fade-in text-center",children:[e.jsx(E,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--brand-gradient-from-color)"}}),e.jsx("p",{className:"text-gray-600",children:r("loading")})]})})},Ze=({error:r})=>{const{t:s}=f();return e.jsx("div",{className:`
        min-h-screen pt-24 flex items-center justify-center
        bg-gradient-to-br
        from-brand-gradient-from-light to-brand-gradient-to-light
        dark:bg-[#222636] dark:from-none dark:to-none
      `,children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx(F,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:s("profileLoadError")||"خطأ في تحميل الملف الشخصي"}),e.jsx("p",{className:"text-gray-600 mb-4",children:r}),e.jsxs(w,{onClick:()=>window.location.reload(),className:"bg-brand-accent text-brand-accent-foreground hover:brightness-95",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),s("retry")||"إعادة المحاولة"]})]})})},Je=()=>{const{t:r}=f();return e.jsx("div",{className:`
        min-h-screen pt-24 flex items-center justify-center
        bg-gradient-to-br
        from-brand-gradient-from-light to-brand-gradient-to-light
        dark:bg-[#222636] dark:from-none dark:to-none
      `,children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:r("profileNotFound")||"لم يتم العثور على الملف الشخصي"}),e.jsx("p",{className:"text-gray-600 mb-4",children:r("profileNotFoundDetail")||"يرجى تسجيل الدخول مرة أخرى أو إنشاء حساب جديد"}),e.jsxs(w,{onClick:()=>window.location.reload(),className:"bg-brand-accent text-brand-accent-foreground hover:brightness-95",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),r("retry")||"إعادة المحاولة"]})]})})},Ke=({permission:r,isSubscribed:s,isProcessing:a,handleToggleNotifications:t,t:n})=>{const c=()=>n(r==="denied"?"notificationsBlocked":s?"disableNotifications":"enableNotifications");return e.jsxs("div",{className:"bg-white dark:bg-[#222636] dark:text-foreground p-6 rounded-2xl shadow-lg animate-fade-in transition-all duration-500",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:`
            p-2 bg-brand-accent-light rounded-full flex-shrink-0
            rtl:ms-8 ltr:mr-5
            sm:rtl:ms-10 sm:ltr:mr-6
          `,children:e.jsx(M,{className:"w-6 h-6 text-brand-accent"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 px-[18px]",children:n("notificationSettings")})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-sm",children:n("notificationSettingsDesc")}),e.jsx(w,{onClick:t,disabled:r==="denied"||a,className:"w-full",variant:s?"destructive":"default",children:a?e.jsx(E,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[s?e.jsx(Pe,{className:"mr-2 h-4 w-4"}):e.jsx(M,{className:"mr-2 h-4 w-4"}),c()]})}),r==="denied"&&e.jsx("p",{className:"text-red-500 text-xs mt-3 text-center",children:n("notificationsBlockedDesc")}),r==="granted"&&s&&e.jsx("p",{className:"text-green-600 text-xs mt-3 text-center",children:n("notificationsSubscribed")})]})},fr=()=>{const{t:r,currentLanguage:s}=f(),{profile:a,loading:t,error:n,updateProfile:c}=pe(),{user:m}=I(),o=ge(),{toast:i}=D(),{isSubscribed:b,permission:k,setupPushNotifications:y,disablePushNotifications:h,isProcessing:l}=fe(),{theme:d,setTheme:u}=Q(),[x,g]=p.useState(!1),[N,U]=p.useState(!1),[j,P]=p.useState({full_name:(a==null?void 0:a.full_name)||"",username:(a==null?void 0:a.username)||"",phone:(a==null?void 0:a.phone)||"",whatsapp_number:(a==null?void 0:a.whatsapp_number)||"",user_type:(a==null?void 0:a.user_type)||"client",language_preference:(a==null?void 0:a.language_preference)||"ar",theme_preference:(a==null?void 0:a.theme_preference)==="dark"?"dark":(a==null?void 0:a.theme_preference)==="light"?"light":"system"}),[Ye,se]=p.useState("default");p.useState(!1);const[T,te]=p.useState(!1);p.useEffect(()=>{"Notification"in window&&se(Notification.permission)},[]),p.useEffect(()=>{if(a&&(P({full_name:a.full_name||"",username:a.username||"",phone:a.phone||"",whatsapp_number:a.whatsapp_number||"",user_type:a.user_type,language_preference:a.language_preference,theme_preference:a.theme_preference==="dark"?"dark":a.theme_preference==="light"?"light":"system"}),!T&&a.theme_preference)){const v=a.theme_preference==="dark"?"dark":a.theme_preference==="light"?"light":"system";d!==v&&u(v),te(!0)}},[a,d,u,T]);const ne=async v=>{P(oe=>({...oe,theme_preference:v})),ae(u,v);const $=await c({theme_preference:v});i($?{title:r("success")||"نجح",description:r("themeUpdated")||"تم تحديث الوضع بنجاح"}:{title:r("error")||"خطأ",description:r("themeUpdateError")||"حصل خطأ أثناء حفظ الثيم",variant:"destructive"})},le=async()=>{U(!0);try{if(!j.full_name||!j.username||!j.phone){i({title:r("error")||"خطأ",description:r("required_fields_missing")||"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"}),U(!1);return}const v={full_name:j.full_name,username:j.username,phone:j.phone,whatsapp_number:j.whatsapp_number,user_type:j.user_type,language_preference:j.language_preference,theme_preference:j.theme_preference==="dark"?"dark":"light"};j.user_type!=="client"&&(v.is_approved=!1),console.log("Updating profile with data:",v),await c(v)?(i({title:r("success")||"نجح",description:r("profileUpdated")||"تم تحديث الملف الشخصي بنجاح"}),g(!1),u(j.theme_preference==="dark"?"dark":j.theme_preference==="light"?"light":"system")):i({title:r("error")||"خطأ",description:r("profileUpdateError")||"فشل في تحديث الملف الشخصي",variant:"destructive"})}catch(v){console.error("Error saving profile:",v),i({title:r("error")||"خطأ",description:r("profileUpdateError")||"فشل في تحديث الملف الشخصي",variant:"destructive"})}finally{U(!1)}},ie=()=>{g(!1),P({full_name:(a==null?void 0:a.full_name)||"",username:(a==null?void 0:a.username)||"",phone:(a==null?void 0:a.phone)||"",whatsapp_number:(a==null?void 0:a.whatsapp_number)||"",user_type:(a==null?void 0:a.user_type)||"client",language_preference:(a==null?void 0:a.language_preference)||"en",theme_preference:(a==null?void 0:a.theme_preference)||"system"}),u((a==null?void 0:a.theme_preference)||"system")},ce=v=>{a&&c({avatar_url:v})},de=async()=>{b?await h():await y()};if(t)return e.jsx(Xe,{});if(n)return e.jsx(Ze,{error:n});if(!a)return e.jsx(Je,{});const A={...a,created_at:a.created_at||new Date().toISOString(),updated_at:a.updated_at||new Date().toISOString(),full_name:a.full_name||"",user_type:a.user_type,language_preference:a.language_preference,theme_preference:a.theme_preference,username:a.username||"",phone:a.phone||"",is_approved:a.is_approved??!1};return e.jsx("div",{className:"min-h-screen pt-32 bg-gradient-to-br to-brand-gradient-to-light dark:bg-[#222636] py-12 px-4 transition-colors duration-300",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 md:gap-6 mb-6 sm:mb-8 md:mb-10",children:[e.jsx(w,{variant:"outline",onClick:()=>o(-1),className:"rounded-full p-2 md:p-3 shrink-0 px-[16px] py-[8px]",children:s==="ar"?e.jsx(Se,{className:"w-4 h-4 md:w-5 md:h-5"}):e.jsx(Ue,{className:"w-4 h-4 md:w-5 md:h-5"})}),e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold flex-1 text-gray-900 dark:text-white truncate",children:r("profile")})]}),e.jsx(Fe,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-[#222636] dark:text-foreground rounded-2xl shadow-lg p-4 transition-colors duration-300",children:[e.jsx(Le,{profile:A,user:m,onAvatarUpdate:ce}),e.jsx("div",{className:"mt-16",children:e.jsx(Qe,{value:j.theme_preference==="dark"?"dark":"light",onChange:ne,isEditing:!0})})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[A.user_type==="partner_and_site_owner"&&A.is_approved===!1&&e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-300 dark:text-yellow-900 rounded-xl px-4 py-3 mb-2 flex items-center gap-3 shadow",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:r("approvalPending_partner")||"طلبك للتحويل إلى شريك ومالك الموقع قيد المراجعة من الأدمن. سيتم إشعارك فور الموافقة."})]}),e.jsx("div",{className:"bg-white dark:bg-[#222636] dark:text-foreground rounded-2xl shadow-lg p-6 transition-colors duration-300",children:e.jsx(Ge,{isEditing:x,setIsEditing:g,isSaving:N,formData:j,setFormData:P,profile:A,user:m,onSave:le,onCancel:ie})}),e.jsx(Ke,{permission:k,isSubscribed:b,isProcessing:l,handleToggleNotifications:de,t:r})]})]})]})})};export{fr as default};
