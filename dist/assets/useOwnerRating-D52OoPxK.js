import{c as j,a as S,G as k,u as _,r as c,j as e,I as w,s as x,az as $,X as E}from"./index-Ba-_IHuQ.js";import{D as O,f as C,a as N,g as z,c as P,d as T}from"./dialog-Bi8CA0Hs.js";import{S as F}from"./star-BDVVLF9N.js";import{S as L}from"./send-DBGujvD3.js";/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],X=j("flag",q);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],B=j("pencil",G),Y=({ownerId:t,ownerName:i,onClose:o})=>{const{currentLanguage:h}=S(),{toast:n}=k(),{user:u}=_(),[a,l]=c.useState(0),[v,d]=c.useState(0),[g,m]=c.useState(!1),[f,b]=c.useState(!1),[R,y]=c.useState(null),s={ar:{rateUser:`تقييم ${i}`,yourRating:"تقييمك:",submitReview:"إرسال التقييم",updateReview:"تعديل التقييم",submitting:"جاري الإرسال...",updating:"جاري التعديل...",cancel:"إلغاء",selectRating:"الرجاء تحديد تقييم",loginRequired:"يجب تسجيل الدخول للتقييم.",submissionError:"حدث خطأ أثناء إرسال التقييم.",submissionSuccessTitle:"تم إرسال التقييم",submissionSuccessDescription:`شكراً لك على تقييم ${i}.`,editingSuccess:"تم تحديث تقييمك.",alreadyRated:"لقد قمت بتقييم هذا المستخدم بالفعل. يمكنك تعديل تقييمك."},en:{rateUser:`Rate ${i}`,yourRating:"Your Rating:",submitReview:"Submit Review",updateReview:"Update Rating",submitting:"Submitting...",updating:"Updating...",cancel:"Cancel",selectRating:"Please select a rating",loginRequired:"You must be logged in to rate.",submissionError:"Error submitting your rating.",submissionSuccessTitle:"Rating Submitted",submissionSuccessDescription:`Thank you for rating ${i}.`,editingSuccess:"Your rating has been updated.",alreadyRated:"You have already rated this user. You can update your rating."},tr:{rateUser:`${i} Değerlendir`,yourRating:"Puanınız:",submitReview:"Yorumu Gönder",updateReview:"Puanı Güncelle",submitting:"Gönderiliyor...",updating:"Güncelleniyor...",cancel:"İptal",selectRating:"Lütfen bir puan seçin",loginRequired:"Puan vermek için giriş yapmalısınız.",submissionError:"Puanınız gönderilirken hata oluştu.",submissionSuccessTitle:"Puan Gönderildi",submissionSuccessDescription:`${i} puanladığınız için teşekkürler.`,editingSuccess:"Puanınız güncellendi.",alreadyRated:"Daha önce puan verdiniz. Puanınızı güncelleyebilirsiniz."}}[h];c.useEffect(()=>{(async()=>{if(!u||!t)return;const{data:r,error:U}=await x.from("user_reviews").select("id, rating").eq("reviewed_user_id",t).eq("reviewer_user_id",u.id).limit(1).maybeSingle();r&&r.rating?(l(r.rating),b(!0),y(r.id)):(l(0),b(!1),y(null))})()},[u,t]);const D=async p=>{if(p.preventDefault(),!u){n({title:s.loginRequired,variant:"destructive"});return}if(a===0){n({title:s.selectRating,variant:"destructive"});return}m(!0);try{if(f&&R){const{error:r}=await x.from("user_reviews").update({rating:a}).eq("id",R);r?(console.error("Error updating rating:",r),n({title:s.submissionError,description:r.message,variant:"destructive"})):(n({title:s.editingSuccess}),o())}else{const{error:r}=await x.from("user_reviews").insert({reviewed_user_id:t,reviewer_user_id:u.id,rating:a,is_approved:!0,comment:null,property_id:null});r?(console.error("Error submitting rating:",r),n({title:s.submissionError,description:r.message,variant:"destructive"})):(n({title:s.submissionSuccessTitle,description:s.submissionSuccessDescription}),o())}}catch(r){console.error("Exception during rating submission:",r),n({title:s.submissionError,variant:"destructive"})}finally{m(!1)}};return e.jsxs("form",{onSubmit:D,className:"space-y-6 p-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-3",children:s.yourRating}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(p=>e.jsx("button",{type:"button",onClick:()=>l(p),onMouseEnter:()=>d(p),onMouseLeave:()=>d(0),className:"transition-all duration-300 transform hover:scale-125 focus:outline-none p-1",children:e.jsx(F,{className:`w-10 h-10 transition-all duration-300 ${p<=(v||a)?"text-yellow-400 fill-yellow-400 scale-110":"text-gray-300 dark:text-gray-600 hover:text-yellow-300"}`})},p))}),f&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-blue-500 dark:text-blue-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.alreadyRated})]})]}),e.jsxs("div",{className:"flex gap-4 justify-end pt-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:o,className:"px-6 py-2 rounded-full border-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300",children:s.cancel}),e.jsx(w,{type:"submit",disabled:a===0||g,className:"group bg-gradient-to-r from-brand-gradient-from to-brand-gradient-to hover:brightness-110 text-white px-8 py-2 rounded-full transition-all duration-300 transform hover:scale-105 disabled:opacity-60 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),f?s.updating:s.submitting]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 transition-transform duration-300 group-hover:translate-x-1"}),f?s.updateReview:s.submitReview]})})]})]})},J=({ownerId:t,ownerName:i,children:o,onOpenChange:h})=>{const{currentLanguage:n}=S(),[u,a]=$.useState(!1),l=m=>{a(m),h&&h(m)},d={ar:{rateTitle:`تقييم ${i}`,rateDescription:`شاركنا تجربتك مع ${i} لمساعدة الآخرين.`},en:{rateTitle:`Rate ${i}`,rateDescription:`Share your experience with ${i} to help others.`},tr:{rateTitle:`${i} Değerlendir`,rateDescription:`Başkalarına yardımcı olmak için ${i} ile olan deneyiminizi paylaşın.`}}[n],g={background:`linear-gradient(
      135deg, 
      var(--brand-gradient-from-color, #2ec7fa), 
      var(--brand-gradient-to-color, #007cf0)
    )`};return e.jsxs(O,{open:u,onOpenChange:l,children:[e.jsx(C,{asChild:!0,children:o}),e.jsx(N,{showCloseButton:!1,className:"p-0 overflow-hidden rounded-2xl max-w-full w-[360px] !border-0 shadow-4xl",style:{background:"none"},children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"px-8 pb-6 pt-7 rounded-t-2xl text-center flex flex-col items-center relative",style:g,children:[e.jsx(z,{asChild:!0,children:e.jsx("button",{className:"absolute top-4 right-4 text-white/80 hover:text-white bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300","aria-label":"Close",children:e.jsx(E,{className:"w-6 h-6"})})}),e.jsx(P,{className:"text-2xl font-extrabold text-white text-center p-0 m-0 drop-shadow-md",style:{fontFamily:"inherit"},children:d.rateTitle}),e.jsx(T,{className:"text-white/90 text-center mt-2 text-base leading-snug font-medium drop-shadow-sm",style:{fontFamily:"inherit"},children:d.rateDescription})]}),e.jsx("div",{className:"p-7 bg-white dark:bg-[#222636] rounded-b-2xl shadow-2xl -mt-1",children:e.jsx(Y,{ownerId:t,ownerName:i,onClose:()=>l(!1)})})]})})]})},K=t=>{const[i,o]=c.useState(null),[h,n]=c.useState(!0);return c.useEffect(()=>{if(!t){console.log("useOwnerRating: No ownerId provided, skipping rating fetch."),n(!1),o({averageRating:0,ratingCount:0});return}console.log(`useOwnerRating: Starting to fetch owner rating for ownerId: ${t}`),(async()=>{n(!0);try{const{data:a,error:l}=await x.from("user_reviews").select("rating").eq("reviewed_user_id",t).eq("is_approved",!0);if(console.log(`useOwnerRating: Fetched reviews for ownerId ${t}:`,a,"Error:",l),l){console.error("useOwnerRating: Error fetching owner ratings:",l),o({averageRating:0,ratingCount:0});return}if(a&&a.length>0){const d=a.reduce((m,f)=>m+f.rating,0)/a.length,g={averageRating:parseFloat(d.toFixed(1)),ratingCount:a.length};console.log(`useOwnerRating: Calculated ownerRatingData for ${t}:`,g),o(g)}else console.log(`useOwnerRating: No approved reviews found for ${t}, setting default rating data.`),o({averageRating:0,ratingCount:0})}catch(a){console.error(`useOwnerRating: Exception fetching owner ratings for ${t}:`,a),o({averageRating:0,ratingCount:0})}finally{console.log(`useOwnerRating: Finished rating fetch for ${t}, ratingLoading set to false.`),n(!1)}})()},[t]),{ownerRatingData:i,ratingLoading:h}};export{X as F,J as O,K as u};
