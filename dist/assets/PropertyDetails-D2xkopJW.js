import{c as re,u as ye,r as m,s as q,a as I,G as me,j as e,I as A,at as Ue,H as V,N as J,O as ee,Q as te,D as Y,X as Ie,as as Oe,a2 as we,a1 as ve,K as je,ae as qe,U as Fe,ay as Ve,V as Ye,az as xe}from"./index-Ba-_IHuQ.js";import{u as Ne,a as He}from"./useAdminStatus-CtzbR6_N.js";import{u as Xe,d as We,t as Ze,g as Ke,b as Ge}from"./cityUtils-DwiwOoBI.js";import{D as ue,f as ke,a as he,b as _e,c as Ce,d as Se}from"./dialog-Bi8CA0Hs.js";import{L as ge}from"./label-3yzes-iA.js";import{T as De}from"./textarea-D6kC44b6.js";import{S as Qe,a as Je,b as et,c as tt,d as at}from"./select-B0LLBn5t.js";import{u as $e,E as rt,S as st}from"./separator-wDokUAnQ.js";import{u as nt,V as it}from"./VerifiedBadge-CnJVYRi5.js";import{F as fe,u as ot,O as lt}from"./useOwnerRating-D52OoPxK.js";import{B as H}from"./badge-DRGEcZbO.js";import{C as Z,a as ct,c as dt,b as ae}from"./card-DocFJD5R.js";import{E as Me}from"./eye-off-QLdkjG-i.js";import{C as mt}from"./calendar-BZmh3iBK.js";import{A as ut}from"./arrow-right-Bj_z4KDd.js";import{A as ht}from"./arrow-left-YqLAbwqU.js";import{S as xt,G as gt}from"./StudentHousingBadge-BukBy-_d.js";import{a as Te,b as Re,c as Ee,d as Pe,e as Ae,C as ft}from"./carousel-Bi4J4_1J.js";import{u as pt}from"./useContactSettings-BDmevMpn.js";import{M as oe}from"./message-circle-B7g0Luhq.js";import{S as Q}from"./star-BDVVLF9N.js";import{P as bt}from"./PropertyCard-Dx417oG4.js";import{S as yt}from"./send-DBGujvD3.js";import{M as wt,i as vt,u as ze,P as jt,a as Nt,b as kt,L as _t,m as Ct}from"./proxy--EB9xJuA.js";import{B as St,a as Dt,S as $t}from"./square-CxCi9vpu.js";import"./useQuery-D_0ZzEPi.js";import"./trash-2-D9yzkGdt.js";import"./usePropertyViewsCount-BXmCnfId.js";/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Tt=re("play",Mt);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Et=re("rotate-ccw",Rt);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Le=re("share-2",Pt);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],zt=re("zoom-in",At);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Bt=re("zoom-out",Lt),Ut=a=>{const{user:r}=ye();m.useEffect(()=>{if(!a)return;const i=setTimeout(async()=>{try{const b=`property_view_${a}`,o=localStorage.getItem(b),g=Date.now();if(!o||g-parseInt(o)>36e5){localStorage.setItem(b,g.toString());const{error:s}=await q.from("property_views").insert({property_id:a,viewer_user_id:r==null?void 0:r.id});s?console.error("Error inserting property view:",s):console.log(`Property ${a} viewed and recorded.`)}}catch(b){console.error("Error recording view:",b)}},2e3);return()=>clearTimeout(i)},[a,r])},It=({propertyId:a})=>{const{currentLanguage:r}=I(),{reportProperty:n,loading:i}=$e(),{propertyReportTypes:b}=nt(),{toast:o}=me(),[g,s]=m.useState(!1),[y,t]=m.useState(""),[w,x]=m.useState(""),l=async c=>{if(c.preventDefault(),!y||!w.trim()){o({title:r==="ar"?"خطأ":"Error",description:r==="ar"?"يرجى ملء جميع الحقول":"Please fill all fields",variant:"destructive"});return}const N=await n(a,{report_type:y,reason:w.trim()});N.success?(o({title:r==="ar"?"تم الإرسال":"Submitted",description:r==="ar"?"تم إرسال البلاغ بنجاح":"Report submitted successfully"}),s(!1),t(""),x("")):o({title:r==="ar"?"خطأ":"Error",description:N.error||(r==="ar"?"حدث خطأ":"An error occurred"),variant:"destructive"})},u=c=>r==="ar"?c.name_ar:r==="tr"?c.name_tr:c.name_en,v=c=>r==="ar"?c.description_ar:r==="tr"?c.description_tr:c.description_en;return e.jsxs(ue,{open:g,onOpenChange:s,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:`
            rounded-xl px-2 lg:px-5 py-2 flex items-center gap-2 
            border border-red-200 bg-red-50 text-red-700
            hover:bg-red-100 hover:border-red-300
            dark:bg-red-900/20 dark:border-red-700/50 dark:text-red-400
            dark:hover:bg-red-900/30 dark:hover:border-red-600
            transition-colors shadow
          `,children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium select-none hidden lg:inline",children:r==="ar"?"إبلاغ":r==="tr"?"Bildir":"Report"})]})}),e.jsxs(he,{className:"sm:max-w-md",children:[e.jsxs(_e,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-red-500"}),r==="ar"?"إبلاغ عن العقار":"Report Property"]}),e.jsx(Se,{children:r==="ar"?"يرجى اختيار سبب البلاغ وتقديم التفاصيل":"Please select a reason and provide details for your report"})]}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(ge,{className:"text-sm font-medium",children:r==="ar"?"نوع البلاغ":"Report Type"}),e.jsxs(Qe,{value:y,onValueChange:t,children:[e.jsx(Je,{className:"w-full",children:e.jsx(et,{placeholder:r==="ar"?"اختر نوع البلاغ":r==="tr"?"Rapor türünü seçin":"Select report type"})}),e.jsx(tt,{children:b.map(c=>e.jsx(at,{value:c.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:u(c)}),v(c)&&e.jsx("span",{className:"text-xs text-muted-foreground",children:v(c)})]})},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"reason",children:r==="ar"?"تفاصيل البلاغ":"Report Details"}),e.jsx(De,{id:"reason",value:w,onChange:c=>x(c.target.value),placeholder:r==="ar"?"يرجى شرح سبب البلاغ بالتفصيل...":"Please explain your report in detail...",rows:4,required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"submit",disabled:i,className:"flex-1",children:i?r==="ar"?"جارٍ الإرسال...":"Submitting...":r==="ar"?"إرسال البلاغ":"Submit Report"}),e.jsx(A,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:i,children:r==="ar"?"إلغاء":"Cancel"})]})]})]})]})},Ot=({propertyId:a,propertyTitle:r,children:n})=>{const{currentLanguage:i}=I(),{fetchPropertyReports:b,loading:o}=$e(),[g,s]=m.useState(!1),[y,t]=m.useState([]),w={inappropriate_content:{ar:"محتوى غير مناسب",en:"Inappropriate Content",tr:"Uygunsuz İçerik"},false_information:{ar:"معلومات خاطئة",en:"False Information",tr:"Yanlış Bilgi"},spam:{ar:"رسائل مزعجة",en:"Spam",tr:"Spam"},fraud:{ar:"احتيال",en:"Fraud",tr:"Dolandırıcılık"},duplicate:{ar:"إعلان مكرر",en:"Duplicate Listing",tr:"Yinelenen Liste"},other:{ar:"أخرى",en:"Other",tr:"Diğer"}},x={pending:{ar:"قيد المراجعة",en:"Pending",tr:"Beklemede"},reviewed:{ar:"تمت المراجعة",en:"Reviewed",tr:"İncelendi"},resolved:{ar:"تم الحل",en:"Resolved",tr:"Çözüldü"},dismissed:{ar:"مرفوض",en:"Dismissed",tr:"Reddedildi"}};m.useEffect(()=>{g&&l()},[g]);const l=async()=>{const c=await b();if(c.data){const N=c.data.filter(k=>k.property_id===a);t(N)}},u=c=>{switch(c){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"reviewed":return"bg-blue-100 text-blue-800 border-blue-300";case"resolved":return"bg-green-100 text-green-800 border-green-300";case"dismissed":return"bg-gray-100 text-gray-800 border-gray-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},v=c=>{window.open(`/user/${c}`,"_blank")};return e.jsxs(ue,{open:g,onOpenChange:s,children:[e.jsx(ke,{asChild:!0,children:n}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),i==="ar"?`البلاغات ضد ${r}`:`Reports against ${r}`]}),e.jsx(Se,{children:i==="ar"?"جميع البلاغات المقدمة ضد هذا العقار":"All reports submitted against this property"})]}),e.jsx("div",{className:"space-y-4",children:o?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-brand-accent border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:i==="ar"?"جارٍ التحميل...":"Loading..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ue,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:i==="ar"?"لا توجد بلاغات":"No Reports"}),e.jsx("p",{className:"text-gray-500",children:i==="ar"?"لم يتم تقديم أي بلاغات ضد هذا العقار":"No reports have been submitted against this property"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:i==="ar"?`إجمالي البلاغات: ${y.length}`:`Total Reports: ${y.length}`}),y.map(c=>{var N,k,C,$,R,d,h,f,_,M,D;return e.jsxs(Z,{className:"border-l-4 border-l-red-500",children:[e.jsx(ct,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-red-100 rounded-full p-2",children:e.jsx(V,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx(dt,{className:"text-lg",children:((N=w[c.report_type])==null?void 0:N[i])||c.report_type}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mt-1",children:[e.jsx(mt,{className:"w-4 h-4"}),new Date(c.created_at).toLocaleDateString(i==="ar"?"ar-SA":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx(H,{className:`${u(c.status)} font-medium`,children:((k=x[c.status])==null?void 0:k[i])||c.status})]})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i==="ar"?"المبلغ:":"Reported by:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(J,{className:"w-8 h-8",children:[e.jsx(ee,{src:(C=c.profiles)==null?void 0:C.avatar_url}),e.jsx(te,{children:((R=($=c.profiles)==null?void 0:$.full_name)==null?void 0:R.charAt(0))||((h=(d=c.profiles)==null?void 0:d.username)==null?void 0:h.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(A,{variant:"link",className:"p-0 h-auto font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",onClick:()=>{var B;return v((B=c.profiles)==null?void 0:B.username)},children:[((f=c.profiles)==null?void 0:f.full_name)||((_=c.profiles)==null?void 0:_.username)||"Unknown User",e.jsx(rt,{className:"w-3 h-3"})]}),((M=c.profiles)==null?void 0:M.username)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["@",c.profiles.username]})]})]})]}),e.jsx(st,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i==="ar"?"نوع البلاغ:":"Report Type:"}),e.jsx("p",{className:"text-gray-700 bg-blue-50 rounded-lg p-3 border border-blue-200",children:((D=w[c.report_type])==null?void 0:D[i])||c.report_type})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i==="ar"?"تفاصيل البلاغ:":"Report Details:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 rounded-lg p-3 border",children:c.reason})]})]})]},c.id)})]})})]})]})},qt=({onBack:a,property:r,getPropertyTitle:n})=>{const{currentLanguage:i}=I(),{toast:b}=me(),{isAdmin:o}=Ne(),g=async()=>{if(!r)return;const t=window.location.href,w=n?n():r.title;if(navigator.share)try{await navigator.share({title:w,text:`${w} - ${i==="ar"?"شاهد هذا العقار المميز":"Check out this amazing property"}`,url:t})}catch(x){console.log("Error sharing:",x),s(t)}else s(t)},s=(t,w)=>{navigator.clipboard.writeText(t).then(()=>{b({title:i==="ar"?"تم النسخ":"Copied",description:i==="ar"?"تم نسخ رابط العقار إلى الحافظة":"Property link copied to clipboard"})}).catch(()=>{alert(`${i==="ar"?"رابط العقار:":"Property link:"} ${t}`)})},y=i==="ar"?"مشاركة":i==="tr"?"Paylaş":"Share Property";return e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 mb-6",children:[e.jsx(A,{variant:"outline",onClick:a,className:"rounded-full p-2 md:px-4 md:py-2 px-[16px]",children:i==="ar"?e.jsx(ut,{className:"w-4 h-4"}):e.jsx(ht,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-lg md:text-2xl font-bold flex-1 text-gray-900 dark:text-white",children:i==="ar"?"تفاصيل العقار":"Property Details"}),r&&e.jsx(It,{propertyId:r.id}),o&&r&&e.jsx(Ot,{propertyId:r.id,propertyTitle:n?n():r.title||"",children:e.jsxs(A,{variant:"outline",className:`
              rounded-xl px-2 lg:px-5 py-2 flex items-center gap-2 
              border border-gray-200 bg-white text-gray-700
              hover:bg-gray-50
              dark:bg-[#232535] dark:border-[#34364b] dark:text-gray-100
              dark:hover:bg-[#151624] dark:hover:text-white
              transition-colors shadow
            `,"aria-label":i==="ar"?"عرض البلاغات":"View Reports",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium select-none hidden lg:inline",children:i==="ar"?"عرض البلاغات":"View Reports"})]})}),e.jsxs(A,{variant:"outline",className:`
          rounded-xl px-2 lg:px-5 py-2 flex items-center gap-2 
          border border-gray-200 bg-white text-gray-700
          hover:bg-gray-50
          dark:bg-[#232535] dark:border-[#34364b] dark:text-gray-100
          dark:hover:bg-[#151624] dark:hover:text-white
          transition-colors shadow
        `,onClick:g,"aria-label":y,children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium select-none hidden lg:inline",children:y})]})]})},de=({videoUrl:a,title:r,isActive:n,onClick:i,isSelected:b,onOpenLightbox:o})=>{const[g,s]=m.useState(!1),{t:y}=I();return n?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onClick:o,children:[e.jsx("video",{id:"main-video",src:a,className:"w-full h-full object-contain",controls:!0,onClick:t=>t.stopPropagation(),onPlay:()=>s(!0),onPause:()=>s(!1)}),e.jsx("div",{className:"absolute top-4 left-4 bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-semibold pointer-events-none",children:y("video")})]}):e.jsxs("div",{className:Y("relative w-20 h-20 cursor-pointer border-2 rounded-lg overflow-hidden transition-colors hover:border-brand-accent",b?"border-brand-accent":"border-gray-200"),onClick:i,children:[e.jsx("div",{className:"w-full h-full bg-gray-200 bg-cover bg-center",style:{backgroundImage:`url(${a}#t=1)`}}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:e.jsx(Tt,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-500 text-white text-xs px-1 py-0.5 text-center",children:y("video")})]})},Ft=({media:a,videos:r,startIndex:n,onClose:i,getPropertyTitle:b})=>{const[o,g]=m.useState(),[s,y]=m.useState(n),[t,w]=m.useState(1),[x,l]=m.useState({x:0,y:0}),[u,v]=m.useState(!1),[c,N]=m.useState(0),[k,C]=m.useState({x:0,y:0}),[$,R]=m.useState({x:0,y:0}),d=m.useRef(null),h=m.useRef(null);m.useEffect(()=>{if(!o)return;const p=()=>{y(o.selectedScrollSnap()),f()};return o.on("select",p),o.scrollTo(n,!0),()=>{o.off("select",p)}},[o,n]),m.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const f=m.useCallback(()=>{w(1),l({x:0,y:0})},[]),_=m.useCallback(()=>{o&&o.scrollPrev()},[o]),M=m.useCallback(()=>{o&&o.scrollNext()},[o]),D=m.useCallback(()=>{w(p=>Math.min(p*1.5,4))},[]),B=m.useCallback(()=>{const p=Math.max(t/1.5,1);w(p),p<=1&&l({x:0,y:0})},[t]),K=p=>{if(p.length<2)return 0;const L=p[0],O=p[1];return Math.sqrt(Math.pow(O.clientX-L.clientX,2)+Math.pow(O.clientY-L.clientY,2))},se=p=>{p.preventDefault(),p.stopPropagation(),t>1?f():w(2)},ne=m.useCallback(p=>{if(p.touches.length===2)N(K(p.touches));else if(p.touches.length===1&&t>1){v(!0);const L=p.touches[0];C({x:L.clientX,y:L.clientY}),R({x:x.x,y:x.y})}},[t,x.x,x.y]),j=m.useCallback(p=>{if(p.preventDefault(),p.touches.length===2){const L=K(p.touches);if(c>0){const O=L/c;w(G=>Math.max(1,Math.min(G*O,4)))}N(L)}else if(p.touches.length===1&&u&&t>1){const L=p.touches[0],O=L.clientX-k.x,G=L.clientY-k.y,le=$.x+O,X=$.y+G,W=300*t,ce=Math.max(-W,Math.min(W,le)),Be=Math.max(-W,Math.min(W,X));l({x:ce,y:Be})}},[u,t,c,k.x,k.y,$.x,$.y]),S=m.useCallback(()=>{v(!1),N(0)},[]),T=m.useCallback(p=>{t>1&&(v(!0),C({x:p.clientX,y:p.clientY}),R({x:x.x,y:x.y}),p.preventDefault(),p.stopPropagation())},[t,x.x,x.y]),E=m.useCallback(p=>{if(u&&t>1){p.preventDefault();const L=p.clientX-k.x,O=p.clientY-k.y,G=$.x+L,le=$.y+O,X=300*t,W=Math.max(-X,Math.min(X,G)),ce=Math.max(-X,Math.min(X,le));l({x:W,y:ce})}},[u,t,k.x,k.y,$.x,$.y]),P=m.useCallback(()=>{v(!1)},[]),U=p=>{if(!z){p.preventDefault();const L=p.deltaY>0?-.2:.2,O=Math.max(1,Math.min(t+L,4));w(O),O<=1&&l({x:0,y:0})}},z=r.includes(a[s]),F=t>1;return e.jsx(ue,{open:!0,onOpenChange:i,children:e.jsxs(he,{className:"bg-black/90 border-none p-0 w-screen h-screen max-w-full max-h-full flex items-center justify-center flex-col outline-none",onClick:i,children:[e.jsxs(A,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-[100] text-white hover:bg-white/20 hover:text-white pointer-events-auto",style:{position:"fixed",zIndex:9999},onClick:p=>{p.stopPropagation(),p.preventDefault(),i()},children:[e.jsx(Ie,{className:"h-8 w-8"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),!z&&e.jsxs("div",{className:"absolute top-4 left-4 z-[100] flex gap-2",style:{position:"fixed",zIndex:9999},children:[e.jsxs(A,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hover:text-white bg-black/50 border border-white/20 pointer-events-auto",onClick:p=>{p.stopPropagation(),p.preventDefault(),D()},disabled:t>=4,children:[e.jsx(zt,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Zoom In"})]}),e.jsxs(A,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hover:text-white bg-black/50 border border-white/20 pointer-events-auto",onClick:p=>{p.stopPropagation(),p.preventDefault(),B()},disabled:t<=1,children:[e.jsx(Bt,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Zoom Out"})]}),F&&e.jsxs(A,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hover:text-white bg-black/50 border border-white/20 pointer-events-auto",onClick:p=>{p.stopPropagation(),p.preventDefault(),f()},children:[e.jsx(Et,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Reset Zoom"})]})]}),e.jsxs(Te,{setApi:g,className:"w-full h-full",opts:{startIndex:n,loop:a.length>1},onClick:p=>p.stopPropagation(),children:[e.jsx(Re,{children:a.map((p,L)=>e.jsx(Ee,{className:"h-screen flex items-center justify-center p-0",children:r.includes(p)?e.jsx("div",{className:"w-full max-w-4xl h-full flex items-center justify-center",children:e.jsx(de,{videoUrl:p,title:b(),isActive:!0,onClick:()=>{}})}):e.jsx("div",{ref:h,className:Y("w-full h-full flex items-center justify-center touch-none select-none",F?"overflow-hidden cursor-grab":"overflow-hidden cursor-zoom-in",u&&"cursor-grabbing"),onDoubleClick:se,onTouchStart:ne,onTouchMove:j,onTouchEnd:S,onMouseDown:T,onMouseMove:E,onMouseUp:P,onMouseLeave:P,onWheel:U,style:{contain:"layout style paint",isolation:"isolate",zIndex:1},children:e.jsx("img",{ref:d,src:p,alt:b(),className:Y("max-w-full max-h-full object-contain pointer-events-none",!u&&"transition-transform duration-200"),style:{transform:`translate3d(${x.x}px, ${x.y}px, 0) scale(${t})`,transformOrigin:"center center",willChange:u?"transform":"auto",backfaceVisibility:"hidden",perspective:1e3},draggable:!1})})},L))}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:Y("absolute left-4 rtl:right-4 rtl:left-auto top-1/2 -translate-y-1/2 z-[100] text-white transition-all duration-200 pointer-events-auto",F?"bg-black/80 hover:bg-black/95 border-2 border-white/50 shadow-lg w-12 h-12":"bg-white/30 hover:bg-white/50 w-10 h-10"),style:{position:"fixed",zIndex:9999},onClick:p=>{p.stopPropagation(),F&&f(),_()}}),e.jsx(Ae,{className:Y("absolute right-4 rtl:left-4 rtl:right-auto top-1/2 -translate-y-1/2 z-[100] text-white transition-all duration-200 pointer-events-auto",F?"bg-black/80 hover:bg-black/95 border-2 border-white/50 shadow-lg w-12 h-12":"bg-white/30 hover:bg-white/50 w-10 h-10"),style:{position:"fixed",zIndex:9999},onClick:p=>{p.stopPropagation(),F&&f(),M()}})]})]}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4 text-white/80 bg-black/50 px-4 py-2 rounded-full text-sm",children:[e.jsxs("span",{children:[s+1," / ",a.length]}),!z&&F&&e.jsxs("span",{className:"text-xs",children:[Math.round(t*100),"%"]})]}),!z&&e.jsxs("div",{className:"text-white/60 bg-black/30 px-3 py-1 rounded-full text-xs text-center",children:[e.jsx("div",{className:"hidden md:block",children:"Double-click or scroll to zoom • Drag to pan"}),e.jsx("div",{className:"md:hidden",children:"Double-tap to zoom • Pinch to zoom • Drag to pan"})]})]})]})})},Vt=({property:a,isPropertyFavorited:r,onFavoriteClick:n,getPropertyTitle:i})=>{const{t:b,currentLanguage:o}=I(),[g,s]=m.useState(),[y,t]=m.useState(0),[w,x]=m.useState(!1),[l,u]=m.useState(0),v=()=>{if(!a)return{images:[],videos:[]};const h=[];if(a.cover_image&&h.push(a.cover_image),a.images&&Array.isArray(a.images)){const D=a.images.filter(B=>B&&B!==a.cover_image);h.push(...D)}const f=h.filter(D=>D),_=f.filter(D=>typeof D=="string"&&(D.includes(".jpg")||D.includes(".jpeg")||D.includes(".png")||D.includes(".webp")||!D.includes(".mp4"))),M=f.filter(D=>typeof D=="string"&&D.includes(".mp4"));return{images:_,videos:M}},{images:c,videos:N}=v(),k=[...c,...N],C=k.length>0?k[y]:null,$=C?N.includes(C):!1;m.useEffect(()=>{if(!g)return;const h=()=>{t(g.selectedScrollSnap())};return g.on("select",h),t(g.selectedScrollSnap()),()=>{g.off("select",h)}},[g]);const R=h=>{g==null||g.scrollTo(h)},d=h=>{u(h),x(!0)};return e.jsxs(Z,{className:"overflow-hidden",children:[e.jsxs(Te,{setApi:s,className:"relative",opts:{loop:k.length>1},children:[e.jsx(Re,{children:k.map((h,f)=>e.jsx(Ee,{children:e.jsx("div",{className:"w-full h-96 bg-black flex items-center justify-center cursor-pointer",onClick:()=>d(f),children:N.includes(h)?e.jsx(de,{videoUrl:h,title:i(),isActive:f===y,onClick:()=>{},onOpenLightbox:()=>d(f)}):e.jsx("img",{src:h||"/placeholder.svg",alt:i(),className:"w-full h-full object-cover"})})},f))}),!$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 left-4 flex gap-2 z-10",children:a.is_featured&&e.jsxs(H,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white",children:[e.jsx(ft,{className:"w-3 h-3 mr-1"}),b("featured")]})}),e.jsxs("div",{className:"absolute top-4 right-14 flex flex-col gap-1 z-10 px-[14px]",children:[a.deposit===0&&e.jsx(H,{className:"bg-gradient-to-r from-green-400 to-emerald-500 text-white text-xs px-2 py-1 rounded-full shadow",children:o==="ar"?"بدون وديعة":o==="tr"?"Depozitosu Yok":"No Deposit"}),a.commission===0&&e.jsx(H,{className:"bg-gradient-to-r from-purple-400 to-pink-500 text-white text-xs px-2 py-1 rounded-full shadow",children:o==="ar"?"بدون عمولة":o==="tr"?"Komisyonsuz":"No Commission"}),a.is_student_housing&&e.jsx(xt,{isStudentHousing:a.is_student_housing,gender:a.student_housing_gender,className:"text-xs"})]}),e.jsx("div",{className:`
                absolute top-4 right-4 flex gap-2 z-10
                bg-white/80 dark:bg-[#232535]/90
                border border-gray-200 dark:border-[#34364b]
                rounded-full shadow-md
                p-0.5
                transition-colors
              `,children:e.jsx(A,{variant:"ghost",size:"sm",className:`
                  rounded-full
                  bg-transparent
                  hover:bg-gray-100 
                  dark:bg-transparent dark:hover:bg-[#323447]
                  ${r?"text-brand-accent":"text-gray-600 dark:text-gray-300"}
                  transition-colors
                `,onClick:h=>{h.stopPropagation(),n()},children:e.jsx(Oe,{className:`w-5 h-5 ${r?"fill-current":""}`})})})]}),k.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"absolute left-2 rtl:right-2 rtl:left-auto top-1/2 -translate-y-1/2 z-20 bg-white/60 hover:bg-white/90 backdrop-blur-sm border-none text-gray-800"}),e.jsx(Ae,{className:"absolute right-2 rtl:left-2 rtl:right-auto top-1/2 -translate-y-1/2 z-20 bg-white/60 hover:bg-white/90 backdrop-blur-sm border-none text-gray-800"})]})]}),k.length>1&&e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-[#111726]",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:k.map((h,f)=>N.includes(h)?e.jsx(de,{videoUrl:h,title:`${i()} ${f+1}`,isActive:!1,onClick:()=>R(f),isSelected:f===y},f):e.jsx("img",{src:h,alt:`${i()} ${f+1}`,className:`w-20 h-20 object-cover rounded-lg cursor-pointer border-2 transition-all ${f===y?"border-brand-accent scale-105":"border-transparent hover:border-gray-300"}`,onClick:()=>R(f)},f))})}),w&&e.jsx(Ft,{media:k,videos:N,startIndex:l,onClose:()=>x(!1),getPropertyTitle:i})]})},Yt=({property:a,getCurrencySymbol:r})=>{var o,g;const{currentLanguage:n}=I(),i=()=>n==="ar"?"وديعة: ":n==="tr"?"Depozito: ":"Deposit: ",b=()=>n==="ar"?"عمولة: ":n==="tr"?"Komisyon: ":"Commission: ";return e.jsx(Z,{className:"bg-white dark:bg-[#111726] shadow-lg rounded-2xl transition-colors",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-brand-accent dark:text-cyan-300",children:[r(a.currency||"EUR"),a.price.toLocaleString()]}),a.listing_type==="rent"&&e.jsx("div",{className:"text-gray-500 dark:text-cyan-200",children:n==="ar"?"شهرياً":n==="tr"?"aylık":"per month"})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[a.deposit===0?e.jsx(H,{className:"w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white text-base font-semibold rounded-full py-2 dark:bg-gradient-to-r dark:from-green-400 dark:to-emerald-500",children:n==="ar"?"بدون وديعة":n==="tr"?"Depozitosu Yok":"No Deposit"}):e.jsxs("div",{className:"text-base text-gray-800 dark:text-white font-medium rounded-full px-3 py-2 bg-gray-100 dark:bg-[#181e28] w-full transition-colors",children:[i(),r(a.currency||"EUR"),(o=a.deposit)==null?void 0:o.toLocaleString()]}),a.commission===0?e.jsx(H,{className:"w-full bg-gradient-to-r from-purple-400 to-pink-500 text-white text-base font-semibold rounded-full py-2 dark:bg-gradient-to-r dark:from-purple-400 dark:to-pink-500",children:n==="ar"?"بدون عمولة":n==="tr"?"Komisyonsuz":"No Commission"}):e.jsxs("div",{className:"text-base text-gray-800 dark:text-white font-medium rounded-full px-3 py-2 bg-gray-100 dark:bg-[#181e28] w-full transition-colors",children:[b(),r(a.currency||"EUR"),(g=a.commission)==null?void 0:g.toLocaleString()]})]})]})})},Ht=(a,r)=>{const[n,i]=m.useState(null),[b,o]=m.useState(!0);return m.useEffect(()=>{a&&r&&(async()=>{try{console.log("Fetching contact info for property:",a,"owner:",r);const{data:s,error:y}=await q.from("properties").select("owner_name, owner_avatar_url, owner_whatsapp, owner_email, created_by").eq("id",a).single();y&&console.error("Error fetching property:",y),console.log("Property data:",s);const{data:t,error:w}=await q.from("profiles").select("user_type, full_name, avatar_url, whatsapp_number, phone, is_trial_active, trial_started_at").eq("id",r).single();w&&console.error("Error fetching profile:",w),console.log("Profile data:",t);const x=(t==null?void 0:t.trial_started_at)&&new Date(t.trial_started_at)<new Date("2010-01-01");if(t!=null&&t.is_trial_active||x){if(console.log("Trial is active or permanent, showing owner contact info"),s||t){const l=(s==null?void 0:s.owner_whatsapp)||(t==null?void 0:t.whatsapp_number)||(t==null?void 0:t.phone)||"",u=(t==null?void 0:t.phone)||(s==null?void 0:s.owner_whatsapp)||"",v=(s==null?void 0:s.owner_email)||"",c=(s==null?void 0:s.owner_name)||(t==null?void 0:t.full_name)||"",N=(s==null?void 0:s.owner_avatar_url)||(t==null?void 0:t.avatar_url)||null;console.log("Final contact info:",{phone:u,whatsapp:l,email:v,ownerName:c,ownerAvatar:N,userType:(t==null?void 0:t.user_type)||"client",showContactButtons:!0}),i({phone:u,whatsapp:l,email:v,ownerName:c,ownerAvatar:N,userType:(t==null?void 0:t.user_type)||"client",showContactButtons:!0})}}else{console.log("Trial expired, showing site contact info but keeping owner info");const{data:l}=await q.from("contact_settings").select("*").eq("is_active",!0).single();console.log("Site contact info:",l);const u=(s==null?void 0:s.owner_name)||(t==null?void 0:t.full_name)||"",v=(s==null?void 0:s.owner_avatar_url)||(t==null?void 0:t.avatar_url)||null;i({phone:(l==null?void 0:l.phone_number)||"",whatsapp:(l==null?void 0:l.whatsapp_number)||"",email:(l==null?void 0:l.email)||"",ownerName:u,ownerAvatar:v,userType:(t==null?void 0:t.user_type)||"client",showContactButtons:!0})}}catch(s){console.error("Error fetching contact info:",s)}finally{o(!1)}})()},[a,r]),{contactInfo:n,loading:b}},Xt=({contactInfo:a,currentLanguage:r,settings:n,cities:i,citiesLoading:b,getCityNameById:o,getDistrictNameById:g})=>{const s=()=>{var x,l,u,v;if(a.whatsapp){let c="";try{c=((x=document.querySelector("title"))==null?void 0:x.textContent)||""}catch{c=""}let N=a.city??"",k=a.district??"",C="",$="";if(N){const _=o(N);_&&(C=_)}if(k&&typeof g=="function"){const _=g(k);_&&($=_)}let R="";r==="ar"&&((l=n==null?void 0:n.whatsapp_greeting_ar)!=null&&l.trim())?R=n.whatsapp_greeting_ar:r==="en"&&((u=n==null?void 0:n.whatsapp_greeting_en)!=null&&u.trim())?R=n.whatsapp_greeting_en:r==="tr"&&((v=n==null?void 0:n.whatsapp_greeting_tr)!=null&&v.trim())?R=n.whatsapp_greeting_tr:R=r==="ar"?"السلام عليكم، أرغب في الاستفسار حول هذا العقار":r==="tr"?"Merhaba, bu gayrimenkul hakkında bilgi almak istiyorum":"Hello, I would like to inquire about this property";let d="";C&&$?d=`🎯 ${C} - ${$}`:C&&(d=`🎯 ${C}`);const h=[R,"",c];d&&h.push("",d),h.push("",window.location.href);const f=h.join(`
`);window.open(`https://wa.me/${a.whatsapp.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(f)}`,"_blank")}},y=()=>{a.phone&&window.open(`tel:${a.phone}`,"_blank")},t=()=>{if(a.email){const x=r==="ar"?"استفسار عن العقار":r==="tr"?"Emlak Sorgusu":"Property Inquiry",l=r==="ar"?`مرحباً، أنا مهتم بهذا العقار: ${window.location.href}`:r==="tr"?`Merhaba, bu mülkle ilgileniyorum: ${window.location.href}`:`Hello, I'm interested in this property: ${window.location.href}`;window.open(`mailto:${a.email}?subject=${encodeURIComponent(x)}&body=${encodeURIComponent(l)}`,"_blank")}},w=()=>{if(navigator.share)navigator.share({title:a.ownerName||(r==="ar"?"عقار":r==="tr"?"Emlak":"Property"),text:r==="ar"?"شاهد هذا العقار!":r==="tr"?"Bu mülke göz atın!":"Check out this property!",url:window.location.href}).catch(x=>console.log("Error sharing:",x));else try{navigator.clipboard.writeText(window.location.href),alert(r==="ar"?"تم نسخ الرابط!":r==="tr"?"Bağlantı kopyalandı!":"Link copied!")}catch(x){console.error("Failed to copy: ",x)}};return a.showContactButtons?e.jsxs("div",{className:"flex flex-col gap-3",children:[a.phone&&e.jsxs(A,{onClick:y,className:"w-full h-12 rounded-xl text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] hover:brightness-95 flex items-center justify-center gap-2",size:"lg",style:{background:"linear-gradient(135deg, var(--brand-gradient-from-color, #ec489a) 0%, var(--brand-gradient-to-color, #f43f5e) 100%)"},children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{children:r==="ar"?"اتصل الآن":r==="tr"?"Şimdi Ara":"Call Now"})]}),a.email&&e.jsxs("button",{type:"button",onClick:t,className:"w-full bg-white border-2 border-gray-200 text-gray-800 font-medium text-base py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-gray-50 transition-all",children:[e.jsx(ve,{className:"w-5 h-5 text-brand-accent"}),e.jsx("span",{children:r==="ar"?"إرسال رسالة":r==="tr"?"Mesaj Gönder":"Send Message"})]}),a.whatsapp&&e.jsxs("button",{type:"button",onClick:s,className:"w-full bg-gradient-to-r from-green-400 to-emerald-400 text-white font-semibold text-base py-3 rounded-xl flex items-center justify-center gap-2 hover:from-green-500 hover:to-emerald-500 transition-all border-0",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:r==="ar"?"واتساب":"WhatsApp"})]}),e.jsxs("button",{type:"button",onClick:w,className:"w-full bg-gray-50 border-2 border-gray-100 text-gray-700 font-medium text-base py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-gray-100 transition-all",children:[e.jsx(Le,{className:"w-5 h-5"}),e.jsx("span",{children:r==="ar"?"مشاركة العقار":r==="tr"?"Mülkü Paylaş":"Share Property"})]})]}):null},Wt=({propertyId:a,ownerId:r})=>{const{currentLanguage:n}=I(),{contactInfo:i,loading:b}=Ht(a,r),{cities:o,districts:g,loading:s}=je(),{settings:y}=pt();if(b)return e.jsx(Z,{className:"bg-white dark:bg-[#111726] shadow-lg rounded-2xl transition-colors",children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded-xl mt-3"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded-xl mt-3"})]})})});if(!i)return null;function t(x){const l=o.find(u=>u.id===x);return l?n==="ar"?l.name_ar:n==="tr"?l.name_tr:l.name_en:null}function w(x){if(!g)return null;const l=g.find(u=>u.id===x);return l?n==="ar"?l.name_ar:n==="tr"?l.name_tr:l.name_en:null}return e.jsx(Z,{className:"bg-white dark:bg-[#111726] shadow-lg rounded-2xl transition-colors",children:e.jsx(ae,{className:"p-4 space-y-4",children:i.showContactButtons&&e.jsx(Xt,{contactInfo:{ownerName:i.ownerName,ownerAvatar:i.ownerAvatar,userType:i.userType,phone:i.phone,email:i.email,whatsapp:i.whatsapp,showContactButtons:i.showContactButtons,city:i.city,district:i.district},currentLanguage:n,settings:y,cities:o,citiesLoading:s,getCityNameById:t,getDistrictNameById:w})})})},Zt=({property:a})=>{const{currentLanguage:r}=I(),{propertyTypes:n,loading:i}=Xe(),b=We(a,n,r,i);return e.jsx(Z,{className:"bg-white dark:bg-[#111726] shadow-lg rounded-2xl transition-colors",children:e.jsxs(ae,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-2 text-gray-900 dark:text-white",children:r==="ar"?"نوع العقار":r==="tr"?"Emlak Tipi":"Property Type"}),e.jsx(H,{variant:"outline",className:"text-lg px-4 py-2 dark:bg-[#181e28] dark:text-white dark:border-white/20 rounded-full",children:b})]})})},Kt=({ownerId:a,ownerName:r,ownerAvatar:n,userType:i,phone:b,whatsapp:o,email:g})=>{const{currentLanguage:s}=I(),{isAdmin:y}=Ne(),[t,w]=m.useState(null),{ownerRatingData:x,ratingLoading:l}=ot(a);m.useEffect(()=>{async function d(){if(!a)return;const{data:h,error:f}=await q.from("profiles").select("full_name,avatar_url,username,is_verified").eq("id",a).maybeSingle();!f&&h&&w(h)}d()},[a]);const u=d=>{switch(d){case"property_owner":return s==="ar"?"مالك العقار":s==="tr"?"Mülk Sahibi":"Property Owner";case"seller":return s==="ar"?"بائع":s==="tr"?"Satıcı":"Seller";case"real_estate_office":return s==="ar"?"مكتب عقارات":s==="tr"?"Emlak Ofisi":"Real Estate Office";case"partner_and_site_owner":return s==="ar"?"شريك ومالك الموقع":s==="tr"?"Ortak & Site Sahibi":"Partner & Site Owner";default:return s==="ar"?"تم النشر بواسطة":s==="tr"?"Yayınlayan":"Published by"}},v=(x==null?void 0:x.averageRating)||0,c=(x==null?void 0:x.ratingCount)||0,N=d=>{const h=Math.floor(d),f=d%1>=.5,_=5-h-(f?1:0);return e.jsxs(e.Fragment,{children:[[...Array(h)].map((M,D)=>e.jsx(Q,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"},`full-${D}`)),f&&e.jsx(Q,{className:"w-4 h-4 text-yellow-400 fill-yellow-200"},"half"),[...Array(_)].map((M,D)=>e.jsx(Q,{className:"w-4 h-4 text-gray-300 dark:text-gray-600"},`empty-${D}`))]})},k=()=>{const d=(t==null?void 0:t.full_name)||r||"";return d.trim()?d.trim().slice(0,2).toUpperCase():""},C=(t==null?void 0:t.full_name)||r||(s==="ar"?"غير محدد":s==="tr"?"Belirtilmemiş":"Not specified"),$=(t==null?void 0:t.avatar_url)||n||void 0,R=t==null?void 0:t.is_verified;return e.jsxs("div",{className:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-2xl p-6 border border-gray-200/30 dark:border-gray-700/30 shadow-lg hover:shadow-xl transition-all duration-300 animate-fade-in",children:[e.jsx(qe,{to:`/user/${(t==null?void 0:t.username)||a}`,children:e.jsxs("div",{className:"flex items-start gap-4 bg-gradient-to-r from-brand-accent/3 to-brand-accent/5 border border-brand-accent/10 hover:from-brand-accent/8 hover:to-brand-accent/12 hover:shadow-xl hover:shadow-brand-accent/25 rounded-xl p-4 transition-all duration-300 cursor-pointer group hover:border-brand-accent/40 hover:scale-[1.02] transform relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-brand-accent/5 to-brand-accent/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-brand-accent to-brand-accent/60 rounded-full opacity-0 group-hover:opacity-70 transition-all duration-300 blur-sm"}),e.jsxs(J,{className:"w-16 h-16 relative border-4 border-white dark:border-gray-800 rounded-full shadow-lg group-hover:scale-105 group-hover:shadow-2xl transition-all duration-300 ring-0 group-hover:ring-4 group-hover:ring-brand-accent/20",children:[e.jsx(ee,{src:$,alt:C,className:"object-cover"}),e.jsx(te,{className:"text-lg font-semibold bg-gradient-to-br from-brand-gradient-from to-brand-gradient-to text-white",children:k()||e.jsx(Fe,{className:"w-8 h-8"})})]}),!l&&v>0&&e.jsx("div",{className:`absolute -bottom-2 bg-white border-2 border-yellow-300/30 text-yellow-600 rounded-full px-1.5 py-0.5 text-xs font-bold shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105 group-hover:border-yellow-400/50 ${s==="ar"?"-left-2":"-right-2"}`,children:v.toFixed(1)})]}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium group-hover:text-brand-accent/70 transition-colors duration-300",children:u(i)}),e.jsxs("h3",{className:"font-bold text-gray-800 dark:text-gray-50 flex items-center gap-2 text-lg mb-1 group-hover:text-brand-accent dark:group-hover:text-brand-accent transition-colors duration-300",children:[R&&e.jsx(it,{size:"sm"}),e.jsx("span",{className:"truncate",children:C})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:!l&&v>0?N(v):[...Array(5)].map((d,h)=>e.jsx(Q,{className:"w-4 h-4 text-gray-300 dark:text-gray-600 group-hover:text-yellow-300/50 transition-colors duration-300"},h))}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium group-hover:text-brand-accent/80 transition-colors duration-300",children:!l&&v>0?`(${c} ${s==="ar"?"تقييم":s==="tr"?"değerlendirme":"reviews"})`:l?s==="ar"?"جارٍ التحميل...":s==="tr"?"Yükleniyor...":"Loading...":`(${s==="ar"?"لا يوجد تقييمات":s==="tr"?"Değerlendirme yok":"No reviews"})`})]})})]}),e.jsx("div",{className:Y("absolute top-4 opacity-0 group-hover:opacity-100 transition-all duration-300 transform group-hover:translate-x-0",s==="ar"?"left-4 -translate-x-2":"right-4 translate-x-2"),children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-accent/20 flex items-center justify-center",children:e.jsx("div",{className:Y("w-2 h-2 border-brand-accent transform",s==="ar"?"border-l-2 border-b-2 rotate-[45deg]":"border-r-2 border-b-2 rotate-[-45deg]")})})})]})}),y&&(b||o||g)&&e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-brand-accent/5 to-brand-accent/10 rounded-xl border border-brand-accent/20 hover:shadow-lg transition-all duration-300",children:[e.jsxs("h4",{className:"text-sm font-semibold text-brand-accent mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-brand-accent rounded-full animate-pulse"}),s==="ar"?"معلومات الاتصال":s==="tr"?"İletişim Bilgileri":"Contact Information"]}),e.jsxs("div",{className:"space-y-2",children:[b&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(we,{className:"w-4 h-4 text-white"})}),e.jsx("a",{href:`tel:${b}`,className:"text-brand-accent hover:text-brand-accent/80 font-medium transition-colors duration-300",children:b})]}),o&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(oe,{className:"w-4 h-4 text-white"})}),e.jsx("a",{href:`https://wa.me/${o.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-brand-accent hover:text-brand-accent/80 font-medium transition-colors duration-300",children:o})]}),g&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-gray-500 to-gray-600 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ve,{className:"w-4 h-4 text-white"})}),e.jsx("a",{href:`mailto:${g}`,className:"text-brand-accent hover:text-brand-accent/80 font-medium transition-colors duration-300",children:g})]})]})]}),e.jsx("div",{className:"mt-4 flex gap-3",children:e.jsx(lt,{ownerId:a,ownerName:C,children:e.jsxs(A,{variant:"outline",size:"sm",className:"flex-1 text-sm bg-gradient-to-r from-yellow-50 to-orange-50 hover:from-yellow-100 hover:to-orange-100 border-yellow-300 text-yellow-700 dark:from-yellow-900/20 dark:to-orange-900/20 dark:border-yellow-700 dark:text-yellow-400 dark:hover:from-yellow-900/30 dark:hover:to-orange-900/30 font-medium transition-all duration-300 hover:shadow-lg rounded-xl",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),s==="ar"?"تقييم":s==="tr"?"Değerlendir":"Rate"]})})})]})},Gt=({property:a,getCurrencySymbol:r})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(Yt,{property:a,getCurrencySymbol:r}),e.jsx(Kt,{ownerId:a.created_by,ownerName:a.owner_name||"",ownerAvatar:a.owner_avatar_url,userType:"property_owner",phone:a.owner_whatsapp,whatsapp:a.owner_whatsapp,email:a.owner_email}),e.jsx(Wt,{propertyId:a.id,ownerId:a.created_by}),e.jsx(Zt,{property:a})]}),Qt=({property:a,getPropertyTitle:r,getPropertyDescription:n})=>(m.useEffect(()=>{if(!a)return;const i=r(),b=n()||`عقار للإيجار في ${a.city} - ${a.price}€ شهرياً`;let o="";a.cover_image?o=a.cover_image:a.images&&Array.isArray(a.images)&&a.images.length>0&&(o=a.images[0]),o&&!o.startsWith("http")&&(o=window.location.origin+(o.startsWith("/")?o:"/"+o));const g=window.location.href;document.title=`${i} | عقارات قبرص للإيجار`;const s=(t,w,x="property")=>{const l=document.querySelector(`meta[${x}="${t}"]`);if(l&&l.remove(),w){const u=document.createElement("meta");u.setAttribute(x,t),u.content=w,document.head.appendChild(u)}};s("description",b,"name"),s("keywords",`عقار, إيجار, ${a.city}, ${a.property_type}, قبرص`,"name"),s("og:title",i),s("og:description",b),o&&(s("og:image",o),s("og:image:secure_url",o),s("og:image:width","1200"),s("og:image:height","630"),s("og:image:alt",i),s("og:image:type","image/jpeg")),s("og:url",g),s("og:type","website"),s("og:site_name","عقارات قبرص للإيجار"),s("og:locale","ar_AR"),s("twitter:card","summary_large_image","name"),s("twitter:title",i,"name"),s("twitter:description",b,"name"),o&&s("twitter:image",o,"name"),s("twitter:site","@cyprus_rentals","name"),s("article:author","عقارات قبرص للإيجار"),s("article:publisher","عقارات قبرص للإيجار");const y=document.createElement("meta");return y.setAttribute("property","og:updated_time"),y.content=new Date().toISOString(),document.head.appendChild(y),console.log("Meta tags updated:",{title:i,description:b,imageUrl:o,currentUrl:g}),()=>{["og:title","og:description","og:image","og:image:secure_url","og:url","og:type","og:site_name","og:locale","og:image:width","og:image:height","og:image:alt","og:image:type","og:updated_time","twitter:card","twitter:title","twitter:description","twitter:image","twitter:site","article:author","article:publisher"].forEach(w=>{const x=document.querySelector(`meta[property="${w}"], meta[name="${w}"]`);x&&x.remove()})}},[a,r,n]),null),Jt=({currentProperty:a})=>{const{currentLanguage:r}=I(),[n,i]=m.useState([]),[b,o]=m.useState(!0);m.useEffect(()=>{g()},[a.id]);const g=async()=>{try{o(!0);let t=q.from("properties").select("*").eq("status","available").neq("hidden_by_admin",!0).neq("id",a.id).eq("city",a.city).order("created_at",{ascending:!1});a.is_student_housing?t=t.eq("is_student_housing",!0):t=t.eq("is_student_housing",!1);const{data:w,error:x}=await t;if(x)throw x;const l=(w||[]).map(u=>({...u,images:Array.isArray(u.images)?u.images:typeof u.images=="string"?[u.images]:[]}));i(l)}catch(t){console.error("Error fetching suggested properties:",t),i([])}finally{o(!1)}};if(b)return e.jsx("section",{className:"py-16 px-4 bg-gray-50 dark:bg-[#151826]",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-800 rounded w-64 mx-auto mb-4 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-800 rounded w-96 mx-auto animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((t,w)=>e.jsx("div",{className:"bg-gray-200 dark:bg-gray-800 rounded-2xl h-96 animate-pulse"},w))})]})});if(n.length===0)return null;const s=()=>a.is_student_housing?r==="ar"?"سكنات طلابية مقترحة":r==="tr"?"Önerilen Öğrenci Konutları":"Suggested Student Housing":r==="ar"?"عقارات مقترحة":r==="tr"?"Önerilen Mülkler":"Suggested Properties",y=()=>a.is_student_housing?r==="ar"?"جميع السكنات الطلابية المتاحة في نفس المدينة":r==="tr"?"Aynı şehirde mevcut tüm öğrenci konutları":"All available student housing in the same city":r==="ar"?"جميع العقارات المتاحة في نفس المدينة":r==="tr"?"Aynı şehirde mevcut tüm mülkler":"All available properties in the same city";return e.jsx("section",{className:`
        py-16 px-4 
        bg-gradient-to-br from-blue-50 via-white to-orange-50
        dark:bg-[#151826] dark:bg-none
        transition-colors
      `,children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-6",children:[a.is_student_housing?e.jsx(gt,{className:"w-8 h-8 text-orange-500"}):e.jsx(V,{className:"w-8 h-8 text-blue-500"}),e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white",children:s()})]}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:y()})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:n.map((t,w)=>e.jsx("div",{className:"animate-scale-in",style:{animationDelay:`${w*100}ms`},children:e.jsx(bt,{property:Ze(t,r)})},t.id))}),e.jsx("div",{className:"text-center mt-8",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:r==="ar"?`يتم عرض ${n.length} ${a.is_student_housing?"سكن طلابي":"عقار"} متاح في هذه المدينة`:r==="tr"?`Bu şehirde ${n.length} ${a.is_student_housing?"öğrenci konutu":"mülk"} gösteriliyor`:`Showing ${n.length} available ${a.is_student_housing?"student housing":"properties"} in this city`})})]})})};class ea extends m.Component{getSnapshotBeforeUpdate(r){const n=this.props.childRef.current;if(n&&r.isPresent&&!this.props.isPresent){const i=n.offsetParent,b=vt(i)&&i.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=b-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ta({children:a,isPresent:r,anchorX:n,root:i}){const b=m.useId(),o=m.useRef(null),g=m.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:s}=m.useContext(wt);return m.useInsertionEffect(()=>{const{width:y,height:t,top:w,left:x,right:l}=g.current;if(r||!o.current||!y||!t)return;const u=n==="left"?`left: ${x}`:`right: ${l}`;o.current.dataset.motionPopId=b;const v=document.createElement("style");s&&(v.nonce=s);const c=i??document.head;return c.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${b}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${t}px !important;
            ${u}px !important;
            top: ${w}px !important;
          }
        `),()=>{c.removeChild(v),c.contains(v)&&c.removeChild(v)}},[r]),e.jsx(ea,{isPresent:r,childRef:o,sizeRef:g,children:m.cloneElement(a,{ref:o})})}const aa=({children:a,initial:r,isPresent:n,onExitComplete:i,custom:b,presenceAffectsLayout:o,mode:g,anchorX:s,root:y})=>{const t=ze(ra),w=m.useId();let x=!0,l=m.useMemo(()=>(x=!1,{id:w,initial:r,isPresent:n,custom:b,onExitComplete:u=>{t.set(u,!0);for(const v of t.values())if(!v)return;i&&i()},register:u=>(t.set(u,!1),()=>t.delete(u))}),[n,t,i]);return o&&x&&(l={...l}),m.useMemo(()=>{t.forEach((u,v)=>t.set(v,!1))},[n]),m.useEffect(()=>{!n&&!t.size&&i&&i()},[n]),g==="popLayout"&&(a=e.jsx(ta,{isPresent:n,anchorX:s,root:y,children:a})),e.jsx(jt.Provider,{value:l,children:a})};function ra(){return new Map}const ie=a=>a.key||"";function pe(a){const r=[];return m.Children.forEach(a,n=>{m.isValidElement(n)&&r.push(n)}),r}const sa=({children:a,custom:r,initial:n=!0,onExitComplete:i,presenceAffectsLayout:b=!0,mode:o="sync",propagate:g=!1,anchorX:s="left",root:y})=>{const[t,w]=Nt(g),x=m.useMemo(()=>pe(a),[a]),l=g&&!t?[]:x.map(ie),u=m.useRef(!0),v=m.useRef(x),c=ze(()=>new Map),[N,k]=m.useState(x),[C,$]=m.useState(x);kt(()=>{u.current=!1,v.current=x;for(let h=0;h<C.length;h++){const f=ie(C[h]);l.includes(f)?c.delete(f):c.get(f)!==!0&&c.set(f,!1)}},[C,l.length,l.join("-")]);const R=[];if(x!==N){let h=[...x];for(let f=0;f<C.length;f++){const _=C[f],M=ie(_);l.includes(M)||(h.splice(f,0,_),R.push(_))}return o==="wait"&&R.length&&(h=R),$(pe(h)),k(x),null}const{forceRender:d}=m.useContext(_t);return e.jsx(e.Fragment,{children:C.map(h=>{const f=ie(h),_=g&&!t?!1:x===C||l.includes(f),M=()=>{if(c.has(f))c.set(f,!0);else return;let D=!0;c.forEach(B=>{B||(D=!1)}),D&&(d==null||d(),$(v.current),g&&(w==null||w()),i&&i())};return e.jsx(aa,{isPresent:_,initial:!u.current||n?void 0:!1,custom:r,presenceAffectsLayout:b,mode:o,root:y,onExitComplete:_?void 0:M,anchorX:s,children:h},f)})})},na=({value:a,onChange:r,placeholder:n,disabled:i,className:b})=>{const[o,g]=m.useState([]),[s,y]=m.useState(!1),[t,w]=m.useState(0),[x,l]=m.useState(""),[u,v]=m.useState(-1),c=m.useRef(null),N=m.useRef(null),k=async d=>{if(d.length<1){g([]);return}try{const{data:h,error:f}=await q.from("profiles").select("id, username, full_name, avatar_url").or(`username.ilike.%${d}%,full_name.ilike.%${d}%`).limit(5);if(f)throw f;g(h||[])}catch(h){console.error("Error searching users:",h),g([])}},C=d=>{const h=d.target.value,f=d.target.selectionStart;r(h);const M=h.substring(0,f).match(/@(\w*)$/);if(M){const D=M[1],B=f-M[0].length;l(D),v(B),y(!0),w(0),k(D)}else y(!1),g([])},$=d=>{if(u===-1)return;const h=a.substring(0,u),f=a.substring(u+x.length+1),_=`${h}@${d.username} ${f}`;r(_),y(!1),g([]),setTimeout(()=>{if(c.current){const M=u+d.username.length+2;c.current.focus(),c.current.setSelectionRange(M,M)}},0)},R=d=>{if(!(!s||o.length===0))switch(d.key){case"ArrowDown":d.preventDefault(),w(h=>(h+1)%o.length);break;case"ArrowUp":d.preventDefault(),w(h=>(h-1+o.length)%o.length);break;case"Enter":case"Tab":d.preventDefault(),$(o[t]);break;case"Escape":y(!1),g([]);break}};return m.useEffect(()=>{const d=h=>{N.current&&!N.current.contains(h.target)&&c.current&&!c.current.contains(h.target)&&y(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),e.jsxs("div",{className:"relative",children:[e.jsx(De,{ref:c,value:a,onChange:C,onKeyDown:R,placeholder:n,disabled:i,className:b}),s&&o.length>0&&e.jsx("div",{ref:N,className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:o.map((d,h)=>e.jsxs("div",{className:`flex items-center gap-3 px-3 py-2 cursor-pointer transition-colors ${h===t?"bg-brand-accent/10 text-brand-accent":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,onClick:()=>$(d),children:[e.jsx(J,{className:"w-8 h-8",children:d.avatar_url?e.jsx(ee,{src:d.avatar_url,alt:d.full_name||d.username}):e.jsx(te,{className:"bg-brand-accent text-white text-xs",children:(d.full_name||d.username).charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:d.full_name||d.username}),e.jsxs("div",{className:"text-xs text-gray-500",children:["@",d.username]})]})]},d.id))})]})},be=({propertyId:a,propertyOwnerId:r})=>{var D,B,K,se,ne;const[n,i]=m.useState([]),[b,o]=m.useState(""),[g,s]=m.useState(null),[y,t]=m.useState(!1),[w,x]=m.useState(!0);m.useRef(null);const{user:l}=ye(),{t:u,currentLanguage:v,isRTL:c}=I(),{toast:N}=me(),k=j=>{const S=new Map,T=[];j.forEach(P=>{var z,F,p;const U={...P,username:((z=P.user)==null?void 0:z.username)||"user",full_name:(F=P.user)==null?void 0:F.full_name,avatar_url:(p=P.user)==null?void 0:p.avatar_url,mentions:[],replies:[],depth:0};S.set(P.id,U)}),j.forEach(P=>{const U=S.get(P.id);if(P.parent_comment_id){const z=S.get(P.parent_comment_id);z?(U.depth=Math.min((z.depth||0)+1,1),z.replies=z.replies||[],z.replies.push(U)):T.push(U)}else T.push(U)});const E=P=>{P.replies&&P.replies.length>0&&(P.replies.sort((U,z)=>new Date(U.created_at).getTime()-new Date(z.created_at).getTime()),P.replies.forEach(E))};return T.forEach(E),T.sort((P,U)=>new Date(P.created_at).getTime()-new Date(U.created_at).getTime())},C=async()=>{try{x(!0);const{data:j,error:S}=await q.from("property_comments").select(`
          *,
          user:profiles(username, full_name, avatar_url)
        `).eq("property_id",a).order("created_at",{ascending:!0});if(S)throw S;const T=k(j||[]);i(T)}catch(j){console.error("Error loading comments:",j),N({title:u("error"),description:u("commentsLoadError"),variant:"destructive"})}finally{x(!1)}};m.useEffect(()=>{C()},[a]);const $=async j=>{if(j.preventDefault(),!(!b.trim()||!l||y)){t(!0);try{const S=g?f(g):null;let T=null;S&&(T=S.depth===0?S.id:S.parent_comment_id);const{error:E}=await q.from("property_comments").insert({comment:b.trim(),property_id:a,user_id:l.id,parent_comment_id:T});if(E)throw E;o(""),s(null),N({title:u("commentSubmittedTitle"),description:u("commentSubmittedDesc")}),await C()}catch(S){console.error("Error submitting comment:",S),N({title:u("error"),description:u("commentSubmitError"),variant:"destructive"})}finally{t(!1)}}},R=j=>{const S=`@${j.username} `;o(S),s(j.id),setTimeout(()=>{const T=document.querySelector("textarea");T&&(T.focus(),T.setSelectionRange(S.length,S.length))},100)},d=async j=>{if(window.confirm(u("confirmDeleteComment")))try{const{error:S}=await q.from("property_comments").delete().eq("id",j);if(S)throw S;N({title:u("commentDeletedTitle"),description:u("commentDeletedDesc")}),await C()}catch(S){console.error("Error deleting comment:",S),N({title:u("error"),description:u("commentDeleteError"),variant:"destructive"})}},h=j=>j.split(/(@\w+)/g).map((T,E)=>T.startsWith("@")?e.jsx("span",{className:"text-brand-accent font-semibold hover:underline cursor-pointer bg-brand-accent/10 px-1 py-0.5 rounded-md transition-colors hover:bg-brand-accent/20",children:T},E):T),f=(j,S=n)=>{for(const T of S){if(T.id===j)return T;if(T.replies&&T.replies.length>0){const E=f(j,T.replies);if(E)return E}}return null},_=(j,S=0)=>{const E=Math.min(S,1),P=()=>E===0?"":c?"mr-6 md:mr-8":"ml-6 md:ml-8",U=()=>E===0?"border-b border-gray-100 dark:border-gray-800":c?"border-r-2 border-brand-accent/20 pr-4":"border-l-2 border-brand-accent/20 pl-4";return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`${P()}`,children:e.jsxs(Ct.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`flex gap-3 group pb-4 ${U()} last:border-b-0 last:pb-0`,children:[e.jsx(J,{className:`${E>0?"w-8 h-8":"w-10 h-10"} flex-shrink-0`,children:j.avatar_url?e.jsx(ee,{src:j.avatar_url,alt:j.full_name||j.username}):e.jsx(te,{className:"bg-brand-accent text-white font-medium text-xs",children:(j.full_name||j.username).charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-sm",children:j.full_name||j.username}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["@",j.username]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-400",children:M(j.created_at)}),E>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-brand-accent font-medium",children:u("reply")})]})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-200 leading-relaxed mb-3",children:h(j.comment)}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>R(j),className:"text-xs text-gray-500 hover:text-brand-accent px-0 py-1 h-auto font-medium transition-colors",children:u("reply")}),(l==null?void 0:l.id)===j.user_id&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>d(j.id),className:"text-xs text-gray-500 hover:text-red-500 px-0 py-1 h-auto font-medium transition-colors",children:u("delete")})]})]})]})}),j.replies&&j.replies.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:j.replies.map(z=>_(z,S+1))})]},j.id)},M=j=>{const S=new Date(j),E=(new Date().getTime()-S.getTime())/(1e3*60*60);return E<1?u("justNow"):E<24?`${Math.floor(E)}${u("hoursAgo")}`:S.toLocaleDateString(v==="ar"?"ar-EG":v==="tr"?"tr-TR":"en-US")};return w?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-brand-accent border-t-transparent"})}):e.jsx("section",{className:"mt-8",children:e.jsxs("div",{className:"bg-white dark:bg-[#111726] border border-gray-200 dark:border-gray-800 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(oe,{className:"w-5 h-5 text-brand-accent"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[u("comments")," (",n.length,")"]})]}),e.jsx("form",{onSubmit:$,className:"mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(J,{className:"w-10 h-10 flex-shrink-0",children:(D=l==null?void 0:l.user_metadata)!=null&&D.avatar_url?e.jsx(ee,{src:l.user_metadata.avatar_url,alt:((B=l.user_metadata)==null?void 0:B.full_name)||"User"}):e.jsx(te,{className:"bg-brand-accent text-white font-medium",children:(((K=l==null?void 0:l.user_metadata)==null?void 0:K.full_name)||(l==null?void 0:l.email)||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(na,{value:b,onChange:o,placeholder:u(g?"writeReply":"commentPlaceholder"),className:"w-full min-h-[44px] max-h-32 resize-none border-0 bg-gray-50 dark:bg-gray-800 rounded-full px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-brand-accent/20 focus:bg-white dark:focus:bg-gray-700",disabled:y}),b.trim()&&e.jsx(A,{type:"submit",disabled:y,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-brand-accent hover:bg-brand-accent/90 text-white rounded-full w-8 h-8 p-0 flex items-center justify-center",children:y?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):e.jsx(yt,{className:"w-4 h-4"})})]}),g&&e.jsxs("div",{className:"flex items-center justify-between bg-brand-accent/10 rounded-lg px-3 py-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-brand-accent rounded-full"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs text-brand-accent font-medium",children:[u("replyingTo")," @",((se=f(g))==null?void 0:se.username)||"user"]}),((ne=f(g))==null?void 0:ne.depth)===1&&e.jsx("span",{className:"text-xs text-gray-500",children:u("replyWillAppearAtSameLevel")})]})]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>{s(null),o("")},className:"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 h-auto",children:u("cancel")})]})]})]})}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:u("noCommentsYet")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:u("beFirstToComment")})]}):e.jsx(sa,{children:n.map(j=>_(j,0))})})]})})},Pa=()=>{const{id:a}=Ve(),r=Ye(),{currentLanguage:n,t:i}=I(),{cities:b,districts:o,loading:g}=je(),{toggleFavorite:s,isFavorited:y}=He(),[t,w]=m.useState(null),[x,l]=m.useState(!0);Ut(a||""),m.useEffect(()=>{a&&u()},[a]);const u=async()=>{try{const{data:d,error:h}=await q.from("properties").select("*, property_types(*)").eq("id",a).single();if(h)throw h;const f={...d,images:Array.isArray(d.images)?d.images:typeof d.images=="string"?[d.images]:[]};w(f)}catch(d){console.error("Error fetching property:",d)}finally{l(!1)}},v=d=>{switch(d){case"EUR":return"€";case"GBP":return"£";case"USD":return"$";default:return"€"}},c=d=>{if(g)return d;const h=b.find(f=>f.id===d);return h?Ke(h,n):d},N=d=>{if(g)return d;const h=o.find(f=>f.id===d);return h?Ge(h,n):d},k=()=>{if(!t)return"";let d;n==="ar"&&t.title_ar?d=t.title_ar:n==="tr"&&t.title_tr?d=t.title_tr:d=t.title_en||t.title;const h=i("forSale"),f=i("forRent");let _=d;if(t.listing_type==="sale")try{_=_.replace(new RegExp(h,"ig"),"")}catch(M){console.error("Error creating regex from translation",M)}else if(t.listing_type==="rent")try{_=_.replace(new RegExp(f,"ig"),"")}catch(M){console.error("Error creating regex from translation",M)}if(_=_.replace(/-\s*$/,"").trim(),t.listing_type){const M=t.listing_type==="rent"?i("forRent"):i("forSale");return _?`${_} - ${M}`:M}return _},C=()=>t?n==="ar"&&t.description_ar?t.description_ar:n==="tr"&&t.description_tr?t.description_tr:t.description_en||t.description:"",$=()=>{t&&s(t.id)};if(x)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-brand-accent border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-16 h-16 border-4 border-brand-accent/20 rounded-full animate-pulse"})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center animate-fade-in",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-brand-accent/10 to-brand-accent/20 rounded-full flex items-center justify-center",children:e.jsxs("svg",{className:"w-10 h-10 text-brand-accent",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M3 7v13h18V7z"}),e.jsx("path",{d:"M16 3h-8l-2 4h12z"})]})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:n==="ar"?"العقار غير موجود":"Property not found"}),e.jsx(A,{onClick:()=>r("/"),className:"bg-gradient-to-r from-brand-accent to-brand-accent/80 hover:from-brand-accent/90 hover:to-brand-accent text-white shadow-lg hover:shadow-brand-glow transition-all duration-300",children:n==="ar"?"العودة للرئيسية":"Back to Home"})]})});const R=y(t.id);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 transition-colors duration-300 pt-8 lg:pt-10",dir:n==="ar"?"rtl":"ltr",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-10 left-10 text-brand-accent/20 animate-float",children:e.jsx(V,{className:"w-8 h-8"})}),e.jsx("div",{className:"absolute top-1/4 right-20 text-brand-accent/15 animate-bounce-subtle animation-delay-500",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsx("div",{className:"absolute top-1/3 left-1/4 text-brand-accent/10 animate-pulse-soft animation-delay-300",children:e.jsx(V,{className:"w-10 h-10"})}),e.jsx("div",{className:"absolute bottom-32 right-1/3 text-brand-accent/20 animate-float animation-delay-700",children:e.jsx(V,{className:"w-7 h-7"})}),e.jsx("div",{className:"absolute bottom-20 left-1/4 text-brand-accent/15 animate-bounce-subtle animation-delay-1000",children:e.jsx(V,{className:"w-9 h-9"})}),e.jsx("div",{className:"absolute top-2/3 right-10 text-brand-accent/10 animate-pulse-soft animation-delay-800",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 bg-transparent py-[13px] rounded-2xl relative z-10 animate-fade-in",children:[e.jsx(Qt,{property:t,getPropertyTitle:k,getPropertyDescription:C}),e.jsx("div",{className:"animate-scale-in",children:e.jsx(qt,{onBack:()=>r(-1),property:t,getPropertyTitle:k})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12 animate-slide-up animation-delay-200",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"animate-fade-in animation-delay-300",children:e.jsx(Vt,{property:t,isPropertyFavorited:R,onFavoriteClick:$,getPropertyTitle:k})}),e.jsx("div",{className:"mt-6 animate-fade-in animation-delay-500",children:e.jsxs("div",{className:"p-6 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm shadow-lg rounded-2xl transition-all duration-300 hover:shadow-xl border-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-accent dark:text-white mb-4",style:{lineHeight:"1.25"},children:k()}),e.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-300 mb-4",children:[e.jsx("span",{className:"mr-2",children:e.jsx("svg",{className:"inline-block w-4 h-4 text-brand-accent",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8 2 5 5.33 5 9v1a7 7 0 0 0 2 5.2C10 19 12 22 12 22s2-3 5-6.8A7 7 0 0 0 19 10V9c0-3.67-3-7-7-7Z"})})}),e.jsx("span",{children:c(t.city)}),t.district&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:N(t.district)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-gray-600 dark:text-gray-300 mb-6",children:[t.bedrooms&&e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 dark:bg-blue-900/20 rounded-xl px-3 py-2 h-12 min-w-0",children:[e.jsx(St,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-medium truncate",children:[t.bedrooms," ",n==="ar"?"غرفة":n==="tr"?"yatak odası":"beds"]})]}),t.bathrooms&&e.jsxs("div",{className:"flex items-center gap-2 bg-purple-50 dark:bg-purple-900/20 rounded-xl px-3 py-2 h-12 min-w-0",children:[e.jsx(Dt,{className:"w-4 h-4 text-purple-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-medium truncate",children:[t.bathrooms," ",n==="ar"?"حمام":n==="tr"?"banyo":"baths"]})]}),t.area&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 rounded-xl px-3 py-2 h-12 min-w-0",children:[e.jsx($t,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-medium truncate",children:[t.area,n==="ar"?"م²":"m²"]})]})]}),C()&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:n==="ar"?"الوصف":n==="tr"?"Açıklama":"Description"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-100 leading-relaxed",children:C()})]})]})}),e.jsx("div",{className:"mt-10 hidden lg:block animate-fade-in animation-delay-700",children:(t==null?void 0:t.id)&&e.jsx(xe.Suspense,{fallback:e.jsx("div",{children:"...تحميل التعليقات"}),children:e.jsx(be,{propertyId:t.id,propertyOwnerId:t.created_by})})})]}),e.jsx("div",{className:"animate-fade-in animation-delay-400",children:e.jsx(Gt,{property:t,getCurrencySymbol:v})})]}),e.jsx("div",{className:"block lg:hidden mt-10 mb-12 animate-fade-in animation-delay-700",children:(t==null?void 0:t.id)&&e.jsx(xe.Suspense,{fallback:e.jsx("div",{children:"...تحميل التعليقات"}),children:e.jsx(be,{propertyId:t.id,propertyOwnerId:t.created_by})})}),e.jsx("div",{className:"animate-slide-up animation-delay-1000",children:e.jsx(Jt,{currentProperty:t})})]})]})};export{Pa as default};
