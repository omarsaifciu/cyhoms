import{c as se,r as m,s as U,a as ae,j as e,I as x,H as le,U as ne,N as I,O as B,Q as D,M as Te,D as M,T as Pe,a1 as Ne,a2 as ve,G as ce,W as Le,aK as Ee,X as Me}from"./index-Ba-_IHuQ.js";import{u as $e,C as be}from"./useUserActions-DGvKvL3f.js";import{C as k,b as C,a as K,c as Q,d as Y}from"./card-DocFJD5R.js";import{B as L}from"./badge-DRGEcZbO.js";import{T as ze,a as Ie,b as ye,c as we}from"./tabs-3zOAl0ep.js";import{S as _e,a as ke,b as Ce,c as Se,d as z}from"./select-B0LLBn5t.js";import{u as Be,E as X,S as Z}from"./separator-wDokUAnQ.js";import{R as Ue}from"./refresh-cw-Dzle1iAu.js";import{T as Re}from"./triangle-alert-Ds9hEMyA.js";import{U as ee}from"./users-B-O4Ext4.js";import{E as de,a as De}from"./eye-off-QLdkjG-i.js";import{B as qe,a as Fe,S as Oe}from"./square-CxCi9vpu.js";import{I as He}from"./input-BB7eCBwl.js";import{C as Ve}from"./clock-Fq3ibpDw.js";import{C as ie}from"./circle-check-big-D_hgqrRM.js";import{T as Ae}from"./trash-2-D9yzkGdt.js";import{P as We}from"./plus-BhvacCnt.js";import{S as Ge}from"./star-BDVVLF9N.js";/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ke=se("check-check",Xe);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],Ye=se("euro",Qe);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Ze=se("grid-3x3",Je);/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],ss=se("list",es),as=()=>{const[s,n]=m.useState([]),[i,g]=m.useState(!0),f=async()=>{g(!0);try{console.log("Fetching users with emails...");const{data:{user:l}}=await U.auth.getUser(),{data:o,error:h}=await U.from("profiles").select("*").order("created_at",{ascending:!1});if(h)throw console.error("Error fetching profiles:",h),h;console.log("Profiles fetched:",(o==null?void 0:o.length)||0);const p=(o||[]).map(c=>{const N=c.username?`${c.username}@temp-email.com`:c.full_name?`${c.full_name.replace(/\s+/g,".").toLowerCase()}@temp-email.com`:`user-${c.id.substring(0,8)}@temp-email.com`;return{id:c.id,full_name:c.full_name,phone:c.phone||"",user_type:c.user_type,is_approved:c.is_approved||!1,is_verified:c.is_verified||!1,is_suspended:c.is_suspended||!1,language_preference:c.language_preference||"en",theme_preference:c.theme_preference||"system",username:c.username||"",avatar_url:c.avatar_url||null,whatsapp_number:c.whatsapp_number,is_trial_active:c.is_trial_active,trial_started_at:c.trial_started_at,created_at:c.created_at,updated_at:c.updated_at,email:N}});console.log("Combined users created:",p.length),console.log("Combined users data:",p),n(p),g(!1)}catch(l){console.error("Error fetching users:",l),n([])}finally{g(!1)}};return m.useEffect(()=>{f()},[]),{users:s,loading:i,refreshUsers:f}},rs=s=>m.useMemo(()=>s.filter(n=>(n.user_type==="agent"||n.user_type==="property_owner"||n.user_type==="real_estate_office"||n.user_type==="partner_and_site_owner")&&!n.is_approved),[s]),ks=()=>{const{users:s,loading:n,refreshUsers:i}=as(),g=rs(s),{toggleApproval:f,rejectUser:l,updateUserType:o,deleteUser:h,approveAllPending:p,toggleVerification:c,toggleSuspension:N}=$e(i);return{users:s,pendingUsers:g,loading:n,fetchUsers:i,toggleApproval:f,toggleVerification:c,rejectUser:l,updateUserType:o,deleteUser:h,approveAllPending:()=>{const r=g.map(d=>d.id);return p(r)},toggleSuspension:N}},Cs=()=>{const{currentLanguage:s}=ae(),{fetchPropertyReports:n,fetchUserReports:i,updateReportStatus:g,loading:f}=Be(),[l,o]=m.useState([]),[h,p]=m.useState([]),[c,N]=m.useState(null),[T,r]=m.useState(""),[d,b]=m.useState(""),[t,w]=m.useState(!1);m.useEffect(()=>{j()},[]);const j=async()=>{w(!0),console.log("Loading reports...");const[a,y]=await Promise.all([n(),i()]);console.log("Property reports data:",a),console.log("User reports data:",y),o(a.data||[]),p(y.data||[]),w(!1)},_=async(a,y=!1)=>{if(!d)return;(await g(a,d,T,y)).success?(j(),N(null),r(""),b(""),alert(s==="ar"?"تم تحديث حالة البلاغ بنجاح":"Report status updated successfully")):alert("حدث خطأ أثناء تحديث البلاغ")},P=a=>{a&&window.open(`/user/${a}`,"_blank")},re=a=>{a&&window.open(`/property/${a}`,"_blank")},u=a=>{const y={pending:"destructive",reviewed:"secondary",resolved:"default",dismissed:"outline"},A={pending:s==="ar"?"معلق":"Pending",reviewed:s==="ar"?"تمت المراجعة":"Reviewed",resolved:s==="ar"?"تم الحل":"Resolved",dismissed:s==="ar"?"مرفوض":"Dismissed"};return e.jsx(L,{variant:y[a],children:A[a]})},E=a=>{const y={inappropriate_content:s==="ar"?"محتوى غير مناسب":"Inappropriate Content",false_information:s==="ar"?"معلومات خاطئة":"False Information",spam:s==="ar"?"رسائل مزعجة":"Spam",fraud:s==="ar"?"احتيال":"Fraud",duplicate:s==="ar"?"إعلان مكرر":"Duplicate Listing",other:s==="ar"?"أخرى":"Other"},A={inappropriate_behavior:s==="ar"?"سلوك غير مناسب":"Inappropriate Behavior",fake_listings:s==="ar"?"إعلانات وهمية":"Fake Listings",scam:s==="ar"?"نصب واحتيال":"Scam",harassment:s==="ar"?"مضايقة":"Harassment",fraud:s==="ar"?"احتيال":"Fraud",other:s==="ar"?"أخرى":"Other"};return y[a]||A[a]||a},v=a=>a?a.substring(0,2).toUpperCase():"U",te=(a,y="EUR")=>new Intl.NumberFormat(s==="ar"?"ar-SA":"en-US",{style:"currency",currency:y,maximumFractionDigits:0}).format(a),q=l.filter(a=>a.status==="pending"),$=h.filter(a=>a.status==="pending");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s==="ar"?"إدارة البلاغات":"Reports Management"}),e.jsx("p",{className:"text-gray-600",children:s==="ar"?"مراجعة ومعالجة البلاغات المرسلة":"Review and manage submitted reports"})]}),e.jsxs(x,{onClick:j,disabled:t,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ue,{className:`w-4 h-4 ${t?"animate-spin":""}`}),s==="ar"?"تحديث":"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(k,{children:e.jsxs(C,{className:"flex items-center p-6",children:[e.jsx(Re,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s==="ar"?"بلاغات العقارات المعلقة":"Pending Property Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:q.length})]})]})}),e.jsx(k,{children:e.jsxs(C,{className:"flex items-center p-6",children:[e.jsx(ee,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s==="ar"?"بلاغات المستخدمين المعلقة":"Pending User Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:$.length})]})]})}),e.jsx(k,{children:e.jsxs(C,{className:"flex items-center p-6",children:[e.jsx(le,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s==="ar"?"إجمالي بلاغات العقارات":"Total Property Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:l.length})]})]})}),e.jsx(k,{children:e.jsxs(C,{className:"flex items-center p-6",children:[e.jsx(ee,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s==="ar"?"إجمالي بلاغات المستخدمين":"Total User Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:h.length})]})]})})]}),e.jsxs(ze,{defaultValue:"property-reports",className:"w-full",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-2",children:[e.jsxs(ye,{value:"property-reports",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),s==="ar"?"بلاغات العقارات":"Property Reports",q.length>0&&e.jsx(L,{variant:"destructive",className:"ml-2",children:q.length})]}),e.jsxs(ye,{value:"user-reports",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),s==="ar"?"بلاغات المستخدمين":"User Reports",$.length>0&&e.jsx(L,{variant:"destructive",className:"ml-2",children:$.length})]})]}),e.jsx(we,{value:"property-reports",className:"mt-6",children:e.jsxs(k,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:s==="ar"?"بلاغات العقارات":"Property Reports"}),e.jsx(Y,{children:s==="ar"?"قائمة بجميع البلاغات المرسلة للعقارات":"List of all property reports submitted"})]}),e.jsx(C,{children:f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:s==="ar"?"جارٍ تحميل البلاغات...":"Loading reports..."})]}):l.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:s==="ar"?"لا توجد بلاغات للعقارات":"No property reports found"})}):e.jsx("div",{className:"space-y-6",children:l.map(a=>{var y,A,F,O,H,V,W,G;return e.jsx(k,{className:"border-l-4 border-l-red-500",children:e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:E(a.report_type)}),u(a.status)]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(a.created_at).toLocaleDateString(s==="ar"?"ar-SA":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),s==="ar"?"المُبلِغ:":"Reporter:"]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(B,{src:(y=a.profiles)==null?void 0:y.avatar_url}),e.jsx(D,{className:"bg-blue-100 text-blue-600",children:v(((A=a.profiles)==null?void 0:A.full_name)||((F=a.profiles)==null?void 0:F.username))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:((O=a.profiles)==null?void 0:O.full_name)||((H=a.profiles)==null?void 0:H.username)||"Unknown User"}),((V=a.profiles)==null?void 0:V.username)&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>P(a.profiles.username),className:"p-1 h-auto text-blue-600 hover:text-blue-800",children:e.jsx(X,{className:"w-3 h-3"})})]}),((W=a.profiles)==null?void 0:W.username)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["@",a.profiles.username]})]})]})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),s==="ar"?"العقار المُبلغ عنه:":"Reported Property:"]}),a.properties?e.jsx("div",{className:"p-4 bg-orange-50 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:a.properties.cover_image||((G=a.properties.images)==null?void 0:G[0])||"/placeholder.svg",alt:a.properties.title,className:"w-24 h-24 object-cover rounded-lg border border-orange-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-900 text-lg",children:a.properties.title}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>re(a.property_id),className:"flex items-center gap-2 text-orange-600 border-orange-200 hover:bg-orange-100",children:[e.jsx(de,{className:"w-4 h-4"}),s==="ar"?"عرض العقار":"View Property"]})]}),e.jsxs("div",{className:"space-y-2",children:[a.properties.city&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.properties.city,a.properties.district&&`, ${a.properties.district}`]})]}),a.properties.price&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-green-600",children:te(a.properties.price,a.properties.currency)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[a.properties.bedrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:a.properties.bedrooms})]}),a.properties.bathrooms&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:a.properties.bathrooms})]}),a.properties.area&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.properties.area,"m²"]})]})]})]})]})]})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s==="ar"?"عقار محذوف أو غير متاح":"Deleted or Unavailable Property"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",a.property_id]})]})})})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:s==="ar"?"تفاصيل البلاغ:":"Report Details:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 rounded-lg p-3 border",children:a.reason})]}),a.status==="pending"&&e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[e.jsxs(_e,{value:d,onValueChange:b,children:[e.jsx(ke,{className:"w-40",children:e.jsx(Ce,{placeholder:s==="ar"?"تغيير الحالة":"Change Status"})}),e.jsxs(Se,{children:[e.jsx(z,{value:"reviewed",children:s==="ar"?"تمت المراجعة":"Reviewed"}),e.jsx(z,{value:"resolved",children:s==="ar"?"تم الحل":"Resolved"}),e.jsx(z,{value:"dismissed",children:s==="ar"?"مرفوض":"Dismissed"})]})]}),e.jsx(x,{onClick:()=>_(a.id,!1),disabled:!d,size:"sm",children:s==="ar"?"تحديث":"Update"})]})]})},a.id)})})})]})}),e.jsx(we,{value:"user-reports",className:"mt-6",children:e.jsxs(k,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:s==="ar"?"بلاغات المستخدمين":"User Reports"}),e.jsx(Y,{children:s==="ar"?"قائمة بجميع البلاغات المرسلة ضد المستخدمين":"List of all user reports submitted"})]}),e.jsx(C,{children:f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:s==="ar"?"جارٍ تحميل البلاغات...":"Loading reports..."})]}):h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:s==="ar"?"لا توجد بلاغات للمستخدمين":"No user reports found"})}):e.jsx("div",{className:"space-y-6",children:h.map(a=>{var y,A,F,O,H,V,W,G,he,pe,ue,ge,fe,je;return e.jsx(k,{className:"border-l-4 border-l-red-500",children:e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:E(a.report_type)}),u(a.status)]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(a.created_at).toLocaleDateString(s==="ar"?"ar-SA":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),s==="ar"?"المُبلِغ:":"Reporter:"]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(B,{src:(y=a.reporter_profile)==null?void 0:y.avatar_url}),e.jsx(D,{className:"bg-blue-100 text-blue-600",children:v(((A=a.reporter_profile)==null?void 0:A.full_name)||((F=a.reporter_profile)==null?void 0:F.username))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:((O=a.reporter_profile)==null?void 0:O.full_name)||((H=a.reporter_profile)==null?void 0:H.username)||"Unknown User"}),((V=a.reporter_profile)==null?void 0:V.username)&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>P(a.reporter_profile.username),className:"p-1 h-auto text-blue-600 hover:text-blue-800",children:e.jsx(X,{className:"w-3 h-3"})})]}),((W=a.reporter_profile)==null?void 0:W.username)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["@",a.reporter_profile.username]})]})]})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),s==="ar"?"المستخدم المُبلغ عنه:":"Reported User:"]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(B,{src:(G=a.reported_profile)==null?void 0:G.avatar_url}),e.jsx(D,{className:"bg-red-100 text-red-600",children:v(((he=a.reported_profile)==null?void 0:he.full_name)||((pe=a.reported_profile)==null?void 0:pe.username))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:((ue=a.reported_profile)==null?void 0:ue.full_name)||((ge=a.reported_profile)==null?void 0:ge.username)||"Unknown User"}),((fe=a.reported_profile)==null?void 0:fe.username)&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>P(a.reported_profile.username),className:"p-1 h-auto text-red-600 hover:text-red-800",children:e.jsx(X,{className:"w-3 h-3"})})]}),((je=a.reported_profile)==null?void 0:je.username)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["@",a.reported_profile.username]})]})]})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:s==="ar"?"تفاصيل البلاغ:":"Report Details:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 rounded-lg p-3 border",children:a.reason})]}),a.status==="pending"&&e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[e.jsxs(_e,{value:d,onValueChange:b,children:[e.jsx(ke,{className:"w-40",children:e.jsx(Ce,{placeholder:s==="ar"?"تغيير الحالة":"Change Status"})}),e.jsxs(Se,{children:[e.jsx(z,{value:"reviewed",children:s==="ar"?"تمت المراجعة":"Reviewed"}),e.jsx(z,{value:"resolved",children:s==="ar"?"تم الحل":"Resolved"}),e.jsx(z,{value:"dismissed",children:s==="ar"?"مرفوض":"Dismissed"})]})]}),e.jsx(x,{onClick:()=>_(a.id,!0),disabled:!d,size:"sm",children:s==="ar"?"تحديث":"Update"})]})]})},a.id)})})})]})})]})]})},oe=m.forwardRef(({className:s,...n},i)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:i,className:M("w-full caption-bottom text-sm",s),...n})}));oe.displayName="Table";const me=m.forwardRef(({className:s,...n},i)=>e.jsx("thead",{ref:i,className:M("[&_tr]:border-b",s),...n}));me.displayName="TableHeader";const xe=m.forwardRef(({className:s,...n},i)=>e.jsx("tbody",{ref:i,className:M("[&_tr:last-child]:border-0",s),...n}));xe.displayName="TableBody";const ts=m.forwardRef(({className:s,...n},i)=>e.jsx("tfoot",{ref:i,className:M("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n}));ts.displayName="TableFooter";const J=m.forwardRef(({className:s,...n},i)=>e.jsx("tr",{ref:i,className:M("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n}));J.displayName="TableRow";const S=m.forwardRef(({className:s,...n},i)=>e.jsx("th",{ref:i,className:M("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n}));S.displayName="TableHead";const R=m.forwardRef(({className:s,...n},i)=>e.jsx("td",{ref:i,className:M("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n}));R.displayName="TableCell";const ls=m.forwardRef(({className:s,...n},i)=>e.jsx("caption",{ref:i,className:M("mt-4 text-sm text-muted-foreground",s),...n}));ls.displayName="TableCaption";const Ss=({pendingUsers:s,onApprove:n,onReject:i,onApproveAll:g,loading:f})=>{const{currentLanguage:l}=ae(),[o,h]=m.useState(""),[p,c]=m.useState("cards"),N=s.filter(t=>{var j,_;return!o||((j=t.full_name)==null?void 0:j.toLowerCase().includes(o.toLowerCase()))||t.email.toLowerCase().includes(o.toLowerCase())||t.phone.includes(o)||((_=t.whatsapp_number)==null?void 0:_.includes(o))}),T=t=>{window.open(`/user/${t}`,"_blank")},r=t=>new Date(t).toLocaleDateString(l==="ar"?"ar-EG":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",calendar:"gregory"}),d=t=>{switch(t){case"agent":return l==="ar"?"وسيط":l==="tr"?"Acente":"Agent";case"support":return l==="ar"?"دعم فني":l==="tr"?"Destek":"Support";case"property_owner":return l==="ar"?"مالك عقار":"Property Owner";case"real_estate_office":return l==="ar"?"مكتب عقارات":"Real Estate Office";case"partner_and_site_owner":return l==="ar"?"شريك ومالك الموقع":"Partner & Site Owner";default:return t}},b=t=>t.full_name?t.full_name.trim().split(" ")[0].substring(0,2).toUpperCase():t.email?t.email.substring(0,2).toUpperCase():"U";return e.jsxs(k,{children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-orange-500"}),e.jsxs(Q,{children:[l==="ar"?"الطلبات المعلقة":"Pending Approvals",e.jsxs("span",{className:"text-sm font-normal text-gray-500 mr-2",children:["(",N.length," ",l==="ar"?"طلب":"requests",")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:p==="cards"?"default":"outline",size:"sm",onClick:()=>c("cards"),children:e.jsx(Ze,{className:"w-4 h-4"})}),e.jsx(x,{variant:p==="table"?"default":"outline",size:"sm",onClick:()=>c("table"),children:e.jsx(ss,{className:"w-4 h-4"})}),s.length>0&&e.jsxs(x,{onClick:g,disabled:f,size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),l==="ar"?"الموافقة على الكل":"Approve All"]})]})]}),e.jsx(Y,{children:l==="ar"?"طلبات الوسطاء ومالكي العقارات ومكاتب العقارات التي تحتاج موافقة للنشر":l==="tr"?"Yayınlamak için onay gereken acente, mülk sahibi ve emlak ofisi talepleri":"Agent, property owner and real estate office requests that need approval to publish"}),s.length>0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(He,{placeholder:l==="ar"?"البحث بالاسم أو البريد الإلكتروني أو الهاتف أو الواتساب...":"Search by name, email, phone, or WhatsApp...",value:o,onChange:t=>h(t.target.value),className:"pl-10"})]})]}),e.jsx(C,{children:f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:l==="ar"?"جارٍ تحميل الطلبات...":"Loading requests..."})]}):N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:o?l==="ar"?"لم يتم العثور على نتائج":"No results found":l==="ar"?"لا توجد طلبات معلقة":"No pending requests"}),!o&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:l==="ar"?"جميع طلبات الوسطاء ومالكي العقارات ومكاتب العقارات تمت الموافقة عليها":l==="tr"?"Tüm acente, mülk sahibi ve emlak ofisi talepleri onaylandı":"All agent, property owner and real estate office requests have been approved"})]}):p==="cards"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(t=>e.jsx(k,{className:"h-full transition-all duration-200 hover:shadow-lg border-orange-200 bg-orange-50/30",children:e.jsxs(C,{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs(I,{className:"w-16 h-16",children:[e.jsx(B,{src:t.avatar_url,alt:t.full_name||"User"}),e.jsx(D,{className:"text-lg font-bold bg-gradient-to-br from-brand-gradient-from to-brand-gradient-to text-white",children:b(t)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:t.full_name||(l==="ar"?"غير محدد":"Not specified")}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>T(t.username||t.id),className:"ml-auto p-1 h-auto hover:bg-orange-50",title:l==="ar"?"فتح الملف الشخصي":"Open Profile",children:e.jsx(X,{className:"w-4 h-4 text-orange-600"})})]}),e.jsx(L,{variant:"outline",className:"mb-2 bg-orange-100 text-orange-800",children:d(t.user_type)})]})]}),e.jsxs("div",{className:"space-y-3 mb-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ne,{className:"w-4 h-4 flex-shrink-0 text-gray-500"}),e.jsx("a",{href:`mailto:${t.email}`,className:"truncate text-blue-600 hover:text-blue-800 hover:underline transition-colors",title:l==="ar"?"إرسال إيميل":"Send Email",children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ve,{className:"w-4 h-4 flex-shrink-0 text-gray-500"}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-blue-600 hover:text-blue-800 hover:underline transition-colors",title:l==="ar"?"اتصال":"Call",children:t.phone})]}),t.whatsapp_number&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0 text-green-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.570-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),e.jsx("a",{href:`https://wa.me/${t.whatsapp_number.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-800 hover:underline transition-colors",title:l==="ar"?"واتساب":"WhatsApp",children:t.whatsapp_number})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:[l==="ar"?"تاريخ الطلب:":"Request Date:"," ",r(t.created_at)]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[e.jsxs(x,{size:"sm",onClick:()=>n(t.id,t.is_approved),className:"bg-green-600 hover:bg-green-700 text-white flex-1",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),l==="ar"?"موافقة":"Approve"]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>i(t.id),className:"bg-red-600 hover:bg-red-700 text-white flex-1",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),l==="ar"?"رفض":"Reject"]})]})]})},t.id))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(J,{children:[e.jsx(S,{children:l==="ar"?"المستخدم":"User"}),e.jsx(S,{children:l==="ar"?"التواصل":"Contact"}),e.jsx(S,{children:l==="ar"?"النوع المطلوب":"Requested Type"}),e.jsx(S,{children:l==="ar"?"تاريخ الطلب":"Request Date"}),e.jsx(S,{children:l==="ar"?"الإجراءات":"Actions"})]})}),e.jsx(xe,{children:N.map(t=>e.jsxs(J,{className:"bg-orange-50",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(B,{src:t.avatar_url,alt:t.full_name||"User"}),e.jsx(D,{className:"text-sm font-bold bg-gradient-to-br from-brand-gradient-from to-brand-gradient-to text-white",children:b(t)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:t.full_name||(l==="ar"?"غير محدد":"Not specified")}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>T(t.username||t.id),className:"p-1 h-auto hover:bg-orange-50",title:l==="ar"?"فتح الملف الشخصي":"Open Profile",children:e.jsx(X,{className:"w-3 h-3 text-orange-600"})})]})]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ne,{className:"w-3 h-3 text-gray-500"}),e.jsx("a",{href:`mailto:${t.email}`,className:"text-blue-600 hover:text-blue-800 hover:underline transition-colors truncate max-w-[200px]",title:l==="ar"?"إرسال إيميل":"Send Email",children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ve,{className:"w-3 h-3 text-gray-500"}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-blue-600 hover:text-blue-800 hover:underline transition-colors",title:l==="ar"?"اتصال":"Call",children:t.phone})]}),t.whatsapp_number&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("svg",{className:"w-3 h-3 text-green-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.570-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),e.jsx("a",{href:`https://wa.me/${t.whatsapp_number.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-800 hover:underline transition-colors",title:l==="ar"?"واتساب":"WhatsApp",children:t.whatsapp_number})]})]})}),e.jsx(R,{children:e.jsx(L,{variant:"outline",className:"bg-orange-100 text-orange-800",children:d(t.user_type)})}),e.jsx(R,{className:"text-sm text-gray-500",children:r(t.created_at)}),e.jsx(R,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{size:"sm",onClick:()=>n(t.id,t.is_approved),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),l==="ar"?"موافقة":"Approve"]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>i(t.id),className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),l==="ar"?"رفض":"Reject"]})]})})]},t.id))})]})})})]})},Rs=()=>{const{currentLanguage:s}=ae(),{toast:n}=ce(),[i,g]=m.useState([]),[f,l]=m.useState(!0),o=async()=>{l(!0);try{const{data:r,error:d}=await U.from("property_activities").select("*").order("performed_at",{ascending:!1});if(d)throw d;if(!r||r.length===0){g([]),l(!1);return}const b=r.map(u=>u.performed_by).filter(Boolean),t=r.map(u=>u.property_owner_id).filter(Boolean),w=[...new Set([...b,...t])],{data:j,error:_}=await U.from("profiles").select("id, full_name").in("id",w);_&&console.warn("Could not fetch profiles:",_);const P=new Map;try{const{data:u,error:E}=await U.auth.admin.listUsers();!E&&(u!=null&&u.users)&&u.users.forEach(v=>{v!=null&&v.id&&(v!=null&&v.email)&&w.includes(v.id)&&P.set(v.id,v.email)})}catch(u){console.warn("Could not fetch auth users:",u)}const re=r.map(u=>{const E=j==null?void 0:j.find($=>$.id===u.performed_by),v=j==null?void 0:j.find($=>$.id===u.property_owner_id),te=P.get(u.performed_by)||"غير متوفر",q=P.get(u.property_owner_id)||"غير متوفر";return{...u,performer_name:(E==null?void 0:E.full_name)||"غير معروف",performer_email:te,owner_name:(v==null?void 0:v.full_name)||"غير معروف",owner_email:q}});g(re)}catch(r){console.error("Error fetching activities:",r),n({title:s==="ar"?"خطأ":"Error",description:(r==null?void 0:r.message)||(s==="ar"?"فشل في تحميل الأنشطة":"Failed to load activities"),variant:"destructive"})}finally{l(!1)}};m.useEffect(()=>{o()},[]);const h=r=>{switch(r){case"deleted":return s==="ar"?"حذف العقار":"Property Deleted";case"status_changed":return s==="ar"?"تغيير الحالة":"Status Changed";case"created":return s==="ar"?"إنشاء العقار":"Property Created";default:return r}},p=r=>{switch(r){case"deleted":return"bg-red-100 text-red-800";case"status_changed":return"bg-green-100 text-green-800";case"created":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},c=r=>{switch(r){case"deleted":return e.jsx(Ae,{className:"w-4 h-4"});case"status_changed":return e.jsx(ie,{className:"w-4 h-4"});case"created":return e.jsx(de,{className:"w-4 h-4"});default:return null}},N=r=>new Date(r).toLocaleString(s==="ar"?"ar-EG":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",calendar:"gregory"}),T=r=>{if(r!=null&&r.old_status&&(r!=null&&r.new_status)){const d=r.old_status==="available"?s==="ar"?"متاح":"Available":r.old_status==="sold"?s==="ar"?"مباع":"Sold":r.old_status==="pending"?s==="ar"?"مخفي":"Hidden":s==="ar"?"مؤجر":"Rented",b=r.new_status==="available"?s==="ar"?"متاح":"Available":r.new_status==="sold"?s==="ar"?"مباع":"Sold":r.new_status==="pending"?s==="ar"?"مخفي":"Hidden":s==="ar"?"مؤجر":"Rented";return`${d} → ${b}`}return""};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s==="ar"?"أنشطة العقارات":"Property Activities"}),e.jsx("p",{className:"text-gray-600",children:s==="ar"?"تتبع جميع العمليات على العقارات":"Track all property operations"})]}),e.jsxs(x,{onClick:o,disabled:f,variant:"outline",size:"sm",children:[e.jsx(Ue,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),s==="ar"?"تحديث":"Refresh"]})]}),e.jsxs(k,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:s==="ar"?"سجل الأنشطة":"Activity Log"}),e.jsx(Y,{children:s==="ar"?"جميع العمليات المنفذة على العقارات":"All operations performed on properties"})]}),e.jsx(C,{children:f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:s==="ar"?"جارٍ تحميل الأنشطة...":"Loading activities..."})]}):i.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:s==="ar"?"لا توجد أنشطة":"No activities found"})}):e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(J,{children:[e.jsx(S,{children:s==="ar"?"نوع العملية":"Action Type"}),e.jsx(S,{children:s==="ar"?"عنوان العقار":"Property Title"}),e.jsx(S,{children:s==="ar"?"تفاصيل":"Details"}),e.jsx(S,{children:s==="ar"?"مالك العقار":"Property Owner"}),e.jsx(S,{children:s==="ar"?"منفذ العملية":"Performed By"}),e.jsx(S,{children:s==="ar"?"تاريخ العملية":"Date"})]})}),e.jsx(xe,{children:i.map(r=>e.jsxs(J,{children:[e.jsx(R,{children:e.jsxs(L,{className:`flex items-center gap-1 ${p(r.action_type)}`,children:[c(r.action_type),h(r.action_type)]})}),e.jsx(R,{className:"font-medium",children:r.property_title||(s==="ar"?"غير محدد":"Not specified")}),e.jsxs(R,{children:[r.action_type==="status_changed"&&e.jsx("span",{className:"text-sm text-gray-600",children:T(r.action_details)}),r.action_type==="deleted"&&e.jsx("span",{className:"text-sm text-red-600",children:s==="ar"?"تم حذف العقار نهائياً":"Property permanently deleted"})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:r.owner_name}),e.jsx("div",{className:"text-xs text-gray-500",children:r.owner_email})]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:r.performer_name}),e.jsx("div",{className:"text-xs text-gray-500",children:r.performer_email})]})}),e.jsx(R,{className:"text-sm text-gray-600",children:N(r.performed_at)})]},r.id))})]})})]})]})},ns=()=>{const[s,n]=m.useState(!1),{toast:i}=ce(),g=[{rating:5,comment:"موقع ممتاز للبحث عن العقارات في قبرص. واجهة سهلة الاستخدام وخدمة عملاء رائعة.",user_name:"Omar 22404536",user_type:"client"},{rating:5,comment:"تجربة رائعة! وجدت العقار المناسب بسرعة والفريق كان متعاوناً جداً.",user_name:"omar saif admin",user_type:"agent"},{rating:4,comment:"خدمة احترافية ومعلومات دقيقة عن العقارات. أنصح بالموقع بشدة.",user_name:"omar saif admin",user_type:"property_owner"},{rating:5,comment:"موقع موثوق وسهل الاستخدام. ساعدني في العثور على منزل أحلامي.",user_name:"omar saif admin",user_type:"agent"},{rating:4,comment:"فريق محترف وخدمة ممتازة. الموقع يحتوي على خيارات متنوعة من العقارات.",user_name:"omar saif admin",user_type:"client"},{rating:5,comment:"موقع رائع مع واجهة حديثة وسهلة. الدعم الفني سريع ومفيد.",user_name:"omar saif admin",user_type:"property_owner"}],f=async()=>{n(!0);try{const{data:l,error:o}=await U.from("profiles").select("id, full_name, user_type").in("user_type",["client","agent","property_owner"]).limit(6);if(o)throw o;if(!l||l.length===0){i({title:"خطأ",description:"لا توجد مستخدمين في قاعدة البيانات",variant:"destructive"});return}const h=g.slice(0,l.length).map((c,N)=>({user_id:l[N].id,rating:c.rating,comment:c.comment,is_approved:!0,created_at:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()})),{error:p}=await U.from("site_reviews").insert(h);if(p)throw p;i({title:"تم بنجاح",description:`تم إضافة ${h.length} تقييم تجريبي`})}catch(l){console.error("Error adding sample reviews:",l),i({title:"خطأ",description:"حدث خطأ في إضافة التقييمات التجريبية",variant:"destructive"})}finally{n(!1)}};return e.jsx(x,{onClick:f,disabled:s,className:"bg-green-600 hover:bg-green-700 text-white",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-4 h-4 mr-2 animate-spin"}),"جاري الإضافة..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"إضافة تقييمات تجريبية"]})})},Us=()=>{const{currentLanguage:s}=ae(),{toast:n}=ce(),[i,g]=m.useState([]),[f,l]=m.useState(!0),[o,h]=m.useState(!1),p=async()=>{try{const{data:r,error:d}=await U.from("site_reviews").select("*").eq("is_approved",o).order("created_at",{ascending:!1});if(d)throw d;const b=(r==null?void 0:r.map(_=>_.user_id))||[];if(b.length===0){g([]),l(!1);return}const{data:t,error:w}=await U.from("profiles").select("id, full_name, avatar_url, user_type").in("id",b);if(w)throw w;const j=(r==null?void 0:r.map(_=>({..._,profiles:(t==null?void 0:t.find(P=>P.id===_.user_id))||null})))||[];g(j)}catch(r){console.error("Error fetching reviews:",r),n({title:"خطأ",description:"حدث خطأ في تحميل التقييمات",variant:"destructive"})}finally{l(!1)}},c=async r=>{try{const{error:d}=await U.from("site_reviews").update({is_approved:!0}).eq("id",r);if(d)throw d;n({title:"تم الموافقة",description:"تم الموافقة على التقييم بنجاح"}),p()}catch(d){console.error("Error approving review:",d),n({title:"خطأ",description:"حدث خطأ في الموافقة على التقييم",variant:"destructive"})}},N=async r=>{try{const{error:d}=await U.from("site_reviews").delete().eq("id",r);if(d)throw d;n({title:"تم الحذف",description:"تم حذف التقييم بنجاح"}),p()}catch(d){console.error("Error deleting review:",d),n({title:"خطأ",description:"حدث خطأ في حذف التقييم",variant:"destructive"})}};m.useEffect(()=>{p()},[o]);const T=r=>{switch(r){case"agent":return{text:"وسيط",color:"bg-blue-500"};case"property_owner":return{text:"مالك عقار",color:"bg-green-500"};case"real_estate_office":return{text:"مكتب عقارات",color:"bg-purple-500"};default:return{text:"عميل",color:"bg-gray-500"}}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Q,{children:s==="ar"?"إدارة التقييمات":"Reviews Management"}),e.jsx(Y,{children:s==="ar"?"مراجعة والموافقة على تقييمات المستخدمين":"Review and approve user reviews"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ns,{}),e.jsxs(x,{variant:o?"outline":"default",onClick:()=>h(!1),className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),s==="ar"?"في الانتظار":"Pending"]}),e.jsxs(x,{variant:o?"default":"outline",onClick:()=>h(!0),className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),s==="ar"?"المعتمدة":"Approved"]})]})]})}),e.jsx(C,{children:f?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((r,d)=>e.jsx("div",{className:"bg-gray-200 rounded-lg h-32 animate-pulse"},d))}):i.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:s==="ar"?`لا توجد تقييمات ${o?"معتمدة":"في الانتظار"}`:`No ${o?"approved":"pending"} reviews`})}):e.jsx("div",{className:"space-y-4",children:i.map(r=>{var b,t,w;const d=T(((b=r.profiles)==null?void 0:b.user_type)||"client");return e.jsx(k,{className:"border-l-4 border-l-blue-500",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(I,{className:"w-12 h-12",children:[e.jsx(B,{src:((t=r.profiles)==null?void 0:t.avatar_url)||""}),e.jsx(D,{children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:((w=r.profiles)==null?void 0:w.full_name)||"مستخدم"}),e.jsx(L,{className:`${d.color} text-white text-xs`,children:d.text})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[[1,2,3,4,5].map(j=>e.jsx(Ge,{className:`w-4 h-4 ${j<=r.rating?"text-yellow-400 fill-current":"text-gray-300"}`},j)),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",r.rating,"/5)"]})]}),e.jsxs("p",{className:"text-gray-700 mb-2",children:['"',r.comment,'"']}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(r.created_at).toLocaleDateString("ar-SA")})]})]}),!o&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(x,{size:"sm",onClick:()=>c(r.id),className:"bg-green-500 hover:bg-green-600 text-white",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"destructive",onClick:()=>N(r.id),children:e.jsx(Me,{className:"w-4 h-4"})})]}),o&&e.jsx("div",{className:"flex gap-2 ml-4",children:e.jsx(x,{size:"sm",variant:"destructive",onClick:()=>N(r.id),children:e.jsx(Ae,{className:"w-4 h-4"})})})]})})},r.id)})})})]})})};export{Ze as G,ss as L,Ss as P,Cs as R,oe as T,me as a,J as b,S as c,xe as d,R as e,Rs as f,Us as g,ks as u};
