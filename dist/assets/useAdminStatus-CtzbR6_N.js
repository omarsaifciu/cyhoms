import{u as h,G as _,r as c,s as m,a as y}from"./index-Ba-_IHuQ.js";const w=()=>{const{user:e}=h(),{toast:d}=_(),[i,a]=c.useState([]),[l,u]=c.useState(!1);c.useEffect(()=>{e?n():a([])},[e]);const n=async()=>{if(e)try{u(!0);const{data:r,error:o}=await m.from("favorites").select("property_id").eq("user_id",e.id);if(o)throw o;const f=r.map(g=>g.property_id);a(f)}catch(r){console.error("Error fetching favorites:",r)}finally{u(!1)}};return{favorites:i,loading:l,toggleFavorite:async r=>{if(!e){d({title:"تسجيل الدخول مطلوب",description:"يرجى تسجيل الدخول لإضافة العقارات إلى المفضلة",variant:"destructive"});return}try{if(i.includes(r)){const{error:f}=await m.from("favorites").delete().eq("user_id",e.id).eq("property_id",r);if(f)throw f;a(g=>g.filter(S=>S!==r)),d({title:"تم بنجاح",description:"تم إزالة العقار من المفضلة"})}else{const{error:f}=await m.from("favorites").insert([{user_id:e.id,property_id:r}]);if(f)throw f;a(g=>[...g,r]),d({title:"تم بنجاح",description:"تم إضافة العقار إلى المفضلة"})}}catch(o){console.error("Error toggling favorite:",o),d({title:"خطأ",description:"حدث خطأ أثناء تحديث المفضلة",variant:"destructive"})}},isFavorited:r=>i.includes(r),refetch:n}},F=()=>{const{currentLanguage:e}=y(),{toast:d}=_(),[i,a]=c.useState([]),[l,u]=c.useState(!0),n=async()=>{try{u(!0),console.log("Fetching cities...");const{data:t,error:s}=await m.from("cities").select("*").order("name_en",{ascending:!0});if(s)throw console.error("Error fetching cities:",s),s;console.log("Cities fetched successfully:",(t==null?void 0:t.length)||0,t),a(t||[])}catch(t){console.error("Failed to fetch cities:",t),d({title:e==="ar"?"خطأ":"Error",description:e==="ar"?"فشل في تحميل المدن":"Failed to load cities",variant:"destructive"}),a([])}finally{u(!1)}};return c.useEffect(()=>{let t=!0;const s=async()=>{t&&await n()};return i.length===0&&s(),()=>{t=!1}},[]),{cities:i,loading:l,fetchCities:n}},A=()=>{const{currentLanguage:e}=y(),{toast:d}=_(),[i,a]=c.useState([]),[l,u]=c.useState(!0),n=async()=>{var t,s;try{u(!0),console.log("Fetching districts...");const{data:r,error:o}=await m.from("districts").select("*").order("name_en",{ascending:!0});if(o){if(console.error("Error fetching districts:",o),o.code==="PGRST116"||(t=o.message)!=null&&t.includes("relation")||(s=o.message)!=null&&s.includes("does not exist")){console.log("Districts table does not exist, using fallback data");const f=[{id:"1",city_id:"1",name_ar:"وسط المدينة",name_en:"City Center",name_tr:"Şehir Merkezi",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"2",city_id:"1",name_ar:"أكروبوليس",name_en:"Acropolis",name_tr:"Akropolis",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"3",city_id:"1",name_ar:"إنجومي",name_en:"Engomi",name_tr:"Engomi",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"4",city_id:"2",name_ar:"المارينا",name_en:"Marina",name_tr:"Marina",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"5",city_id:"2",name_ar:"جيرماسويا",name_en:"Germasogeia",name_tr:"Germasogeia",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"6",city_id:"3",name_ar:"فينيكودس",name_en:"Finikoudes",name_tr:"Finikoudes",is_active:!0,created_at:new Date().toISOString(),created_by:""},{id:"7",city_id:"4",name_ar:"كاتو بافوس",name_en:"Kato Paphos",name_tr:"Kato Baf",is_active:!0,created_at:new Date().toISOString(),created_by:""}];a(f);return}throw o}console.log("Districts fetched successfully:",(r==null?void 0:r.length)||0,r),a(r||[])}catch(r){console.error("Failed to fetch districts:",r),d({title:e==="ar"?"خطأ":"Error",description:e==="ar"?"فشل في تحميل الأحياء":"Failed to load districts",variant:"destructive"}),a([])}finally{u(!1)}};return c.useEffect(()=>{let t=!0;const s=async()=>{t&&await n()};return i.length===0&&s(),()=>{t=!1}},[]),{districts:i,loading:l,fetchDistricts:n}},D=()=>{const{user:e}=h(),[d,i]=c.useState(!1),[a,l]=c.useState(!0);return c.useEffect(()=>{(async()=>{if(l(!0),!e){i(!1),l(!1);return}try{if(console.log("useAdminStatus: Checking admin status for user:",e.email),e.email==="omar122540@gmail.com"){console.log("useAdminStatus: Primary admin detected"),i(!0),l(!1);return}const{data:n,error:t}=await m.from("admin_management").select("*").eq("admin_email",e.email).eq("is_active",!0).single();if(console.log("useAdminStatus: Admin management query result:",{data:n,error:t}),t&&t.code!=="PGRST116")console.error("useAdminStatus: Error checking admin status:",t),i(!1);else{const s=!!n;console.log("useAdminStatus: Admin status determined:",s),i(s)}}catch(n){console.error("useAdminStatus: Error checking admin status:",n),i(!1)}finally{l(!1)}})()},[e==null?void 0:e.email,e==null?void 0:e.id]),{isAdmin:d,loading:a}};export{w as a,F as b,A as c,D as u};
