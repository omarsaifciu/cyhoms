import{r as p,s as u,V as _,a as w,j as e,I as h,H as j,ay as k,u as N}from"./index-Ba-_IHuQ.js";import{C as y,b}from"./card-DocFJD5R.js";import{B as v}from"./badge-DRGEcZbO.js";import{C as A}from"./clock-Fq3ibpDw.js";import{A as f,D as E,a as P,t as C,s as S}from"./seedUserActivity-CcC_9Fqw.js";import{C as D}from"./calendar-BZmh3iBK.js";import{T as L}from"./trash-2-D9yzkGdt.js";import{S as M}from"./square-pen-XvOR2TU8.js";import{E as T,a as U}from"./eye-off-QLdkjG-i.js";import{f as q}from"./format-D93D0hPk.js";import{e as z}from"./en-US-ZBLZOCkG.js";import{A as B}from"./arrow-right-Bj_z4KDd.js";import{A as R}from"./arrow-left-YqLAbwqU.js";const F=r=>{const[c,a]=p.useState([]),[i,n]=p.useState(!0),[x,g]=p.useState(null),d=async()=>{if(r)try{n(!0),g(null);const{data:t,error:l}=await u.from("user_activity_logs").select(`
          *,
          property:properties(
            id,
            title,
            title_ar,
            title_en,
            title_tr,
            price,
            currency,
            images
          )
        `).eq("user_id",r).order("created_at",{ascending:!1}).limit(50);if(l)throw l;const s=(t==null?void 0:t.map(o=>({...o,property:o.property?{...o.property,title:o.property.title_ar||o.property.title_en||o.property.title_tr||o.property.title}:null})))||[];a(s)}catch(t){console.error("Error fetching user activities:",t),g(t instanceof Error?t.message:"Failed to fetch activities")}finally{n(!1)}},m=async(t,l,s)=>{if(r)try{const{error:o}=await u.from("user_activity_logs").insert({user_id:r,property_id:l,action_type:t,action_details:s||{}});if(o)throw o;await d()}catch(o){console.error("Error logging activity:",o)}};return p.useEffect(()=>{r&&d()},[r]),{activities:c,loading:i,error:x,fetchActivities:d,logActivity:m}},G=({activity:r})=>{var m;const c=_(),{currentLanguage:a}=w(),i=t=>{switch(t){case"property_hidden":return e.jsx(U,{className:"w-4 h-4"});case"property_shown":return e.jsx(T,{className:"w-4 h-4"});case"property_created":return e.jsx(j,{className:"w-4 h-4"});case"property_updated":return e.jsx(M,{className:"w-4 h-4"});case"property_deleted":return e.jsx(L,{className:"w-4 h-4"});case"property_sold":return e.jsx(E,{className:"w-4 h-4"});case"status_changed":return e.jsx(D,{className:"w-4 h-4"});default:return e.jsx(f,{className:"w-4 h-4"})}},n=t=>{var s;return((s={ar:{property_hidden:"تم إخفاء العقار",property_shown:"تم إظهار العقار",property_created:"تم إنشاء عقار جديد",property_updated:"تم تحديث العقار",property_deleted:"تم حذف العقار",property_sold:"تم بيع العقار",status_changed:"تم تغيير حالة العقار"},tr:{property_hidden:"Mülk gizlendi",property_shown:"Mülk gösterildi",property_created:"Yeni mülk oluşturuldu",property_updated:"Mülk güncellendi",property_deleted:"Mülk silindi",property_sold:"Mülk satıldı",status_changed:"Mülk durumu değiştirildi"},en:{property_hidden:"Property hidden",property_shown:"Property shown",property_created:"New property created",property_updated:"Property updated",property_deleted:"Property deleted",property_sold:"Property sold",status_changed:"Property status changed"}}[a])==null?void 0:s[t])||t},x=t=>{switch(t){case"property_hidden":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800";case"property_shown":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800";case"property_created":return"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800";case"property_updated":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800";case"property_deleted":return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800";case"property_sold":return"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800";case"status_changed":return"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-800";default:return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800"}},g=t=>{const l=new Date(t);return q(l,"PPp",{locale:a==="ar"?P:a==="tr"?C:z})},d=t=>{var s;return((s={ar:{available:"متاح",sold:"مباع",rented:"مؤجر",pending:"قيد المراجعة"},tr:{available:"Müsait",sold:"Satıldı",rented:"Kiralandı",pending:"İnceleme"},en:{available:"Available",sold:"Sold",rented:"Rented",pending:"Pending"}}[a])==null?void 0:s[t])||t};return e.jsx(y,{className:"shadow-lg border bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl hover:shadow-xl transition-all duration-300",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg border ${x(r.action_type)}`,children:i(r.action_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:n(r.action_type)}),e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),g(r.created_at)]})]}),r.action_type==="status_changed"&&r.action_details&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[a==="ar"?"من":"From"," ",e.jsx("span",{className:"font-medium",children:d(r.action_details.old_status)})," ",a==="ar"?"إلى":"to"," ",e.jsx("span",{className:"font-medium",children:d(r.action_details.new_status)})]}),r.property&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[((m=r.property.images)==null?void 0:m[0])&&e.jsx("img",{src:r.property.images[0],alt:r.property.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white text-sm",children:r.property.title}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-xs",children:[r.property.price," ",r.property.currency]})]}),r.property.id&&r.action_type!=="property_deleted"&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{var t;return c(`/property/${(t=r.property)==null?void 0:t.id}`)},children:a==="ar"?"عرض":a==="tr"?"Görüntüle":"View"})]})})]})]})})})},re=()=>{const{userId:r}=k(),c=_(),{currentLanguage:a}=w(),{user:i}=N(),{activities:n,loading:x,fetchActivities:g}=F(r),[d,m]=p.useState(null),t=async()=>{r&&(await S(r),await g())};p.useEffect(()=>{if((i==null?void 0:i.id)!==r){c("/");return}},[i,r,c]);const l=async()=>{if(r)try{const{data:s,error:o}=await u.from("profiles").select("*").eq("id",r).single();if(o)throw o;m(s)}catch(s){console.error("Error fetching user profile:",s)}};return p.useEffect(()=>{r&&l()},[r]),x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-accent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a==="ar"?"جاري التحميل...":"Loading..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"outline",onClick:()=>c(-1),className:"rounded-full p-2",children:a==="ar"?e.jsx(B,{className:"w-5 h-5"}):e.jsx(R,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white",children:a==="ar"?"سجل الأنشطة":a==="tr"?"Etkinlik Geçmişi":"Activity Log"})]}),n.length===0&&e.jsx(h,{onClick:t,variant:"outline",size:"sm",children:a==="ar"?"إضافة بيانات تجريبية":"Add Sample Data"})]}),d&&e.jsx(y,{className:"mb-8 shadow-lg border bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-brand-accent to-brand-accent/80 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:d.full_name||d.username}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[a==="ar"?"إجمالي الأنشطة:":"Total Activities:"," ",n.length]})]})]})})}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx(y,{className:"shadow-lg border bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl",children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:a==="ar"?"لا توجد أنشطة":"No Activities"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a==="ar"?"لم يتم تسجيل أي أنشطة بعد.":"No activities have been recorded yet."})]})}):n.map(s=>e.jsx(G,{activity:s},s.id))})]})})};export{re as default};
